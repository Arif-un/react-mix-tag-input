{"version":3,"sources":["../src/MixInput.tsx","../src/utils.ts","../src/index.ts"],"sourcesContent":["import './MixInput.css'\r\n\r\nimport React, {\r\n  type FocusEvent,\r\n  type FormEvent,\r\n  type ForwardedRef,\r\n  forwardRef,\r\n  type KeyboardEvent,\r\n  type SyntheticEvent,\r\n  useEffect,\r\n  useId,\r\n  useImperativeHandle,\r\n  useRef,\r\n  useState,\r\n} from 'react'\r\n\r\nimport * as MixInputType from './MixInputType'\r\nimport {\r\n  createHtmlContent,\r\n  ELEMENT_NODE,\r\n  getCaretInfo,\r\n  getCaretPosition,\r\n  isZeroWidthSpace,\r\n  nodesToArray,\r\n  removeZeroWidthSpace,\r\n  setCaretPosition,\r\n  split,\r\n  stripHtml,\r\n  tagValueArrToString,\r\n} from './utils'\r\n\r\nconst MixInput = forwardRef(\r\n  (props: MixInputType.MixInputProps, ref: ForwardedRef<MixInputType.MixInputRef>) => {\r\n    const {\r\n      onChange,\r\n      onInput,\r\n      onKeyDown,\r\n      onSelect,\r\n      onFocus,\r\n      value,\r\n      multiline,\r\n      placeholder,\r\n      showTagDeleteBtn = false,\r\n      readonly = false,\r\n      tagClassName = 'mtag',\r\n      ...restProps\r\n    } = props\r\n\r\n    const componentId = useId()\r\n    const [content, setContent] = useState('')\r\n    const editorRef = useRef<HTMLDivElement | null>(null)\r\n    const [caretPos, setCaretPos] = useState(999)\r\n\r\n    useImperativeHandle(ref, () => ({\r\n      element: editorRef.current,\r\n      caretPosition: caretPos,\r\n      insertContent,\r\n    }))\r\n\r\n    useEffect(() => {\r\n      updateContentAndCaret({\r\n        triggerOnchange: false,\r\n        newHtmlContent: tagValueArrToString({\r\n          valueArr: value,\r\n          showTagDeleteBtn,\r\n          tagClassName,\r\n        }),\r\n      })\r\n    }, [value, tagClassName, showTagDeleteBtn, tagValueArrToString])\r\n\r\n    useEffect(() => {\r\n      setCaretPosition(editorRef.current, caretPos)\r\n    }, [caretPos])\r\n\r\n    const updateContentAndCaret = ({\r\n      newHtmlContent,\r\n      triggerOnchange = true,\r\n    }: {\r\n      newHtmlContent?: string\r\n      triggerOnchange?: boolean\r\n    } = {}) => {\r\n      const element = editorRef.current\r\n      if (!element) return\r\n      const isHtmlContentPassed = newHtmlContent !== undefined\r\n      const newContent = isHtmlContentPassed ? createHtmlContent(newHtmlContent) : element.innerHTML\r\n      const newContentText = isHtmlContentPassed ? stripHtml(newContent) : element.innerText\r\n      const isZeroWidthSpaceRemovedFromFirst =\r\n        isHtmlContentPassed && isZeroWidthSpace(content.charAt(1))\r\n      let updatedCaret = stripHtml(newContentText).length - stripHtml(content).length\r\n\r\n      if (isZeroWidthSpaceRemovedFromFirst) {\r\n        updatedCaret = 0\r\n      }\r\n      const isStartWithTag = newContent.startsWith('<span')\r\n\r\n      const updatedContent = isStartWithTag ? '&ZeroWidthSpace;' + newContent : newContent\r\n\r\n      setContent(updatedContent)\r\n      if (!isZeroWidthSpaceRemovedFromFirst) {\r\n        setCaretPos((prev) => prev + updatedCaret)\r\n      }\r\n\r\n      if (triggerOnchange) {\r\n        onChange?.(nodesToArray(editorRef.current?.childNodes, tagClassName))\r\n      }\r\n    }\r\n\r\n    const handleSelectionChange = (e: SyntheticEvent<HTMLDivElement, Event>) => {\r\n      onSelect?.(e)\r\n      const { endNode: currentNode } = getCaretInfo(editorRef.current)\r\n      const previousNode = currentNode?.previousSibling\r\n      const nextNode = currentNode?.nextSibling\r\n      const isNextNodeIsSpan = nextNode?.nodeName === 'SPAN'\r\n      const caretPos = getCaretPosition(editorRef.current)\r\n\r\n      if (\r\n        isNextNodeIsSpan &&\r\n        previousNode === null &&\r\n        caretPos === 1 &&\r\n        isZeroWidthSpace(currentNode?.textContent?.at(0))\r\n      ) {\r\n        setCaretPos(0)\r\n      } else {\r\n        setCaretPos(caretPos)\r\n      }\r\n    }\r\n\r\n    const handleKeyDown = (e: KeyboardEvent<HTMLDivElement>) => {\r\n      const key = e.key\r\n      const { endNode: currentNode, endOffset: currentOffset } = getCaretInfo(editorRef.current)\r\n      const previousNode = currentNode?.previousSibling\r\n      const nextNode = currentNode?.nextSibling\r\n      const isNextNodeBr = nextNode?.nodeName === 'BR'\r\n      const zerowidthspaceLength = 2\r\n\r\n      if (\r\n        key === 'ArrowLeft' &&\r\n        currentNode &&\r\n        previousNode &&\r\n        isZeroWidthSpace(currentNode.textContent?.at(currentOffset - 1))\r\n      ) {\r\n        e.preventDefault()\r\n        const previousNodeIsBr = previousNode.nodeName === 'BR'\r\n        const previousNodeIsSpan = previousNode.nodeName === 'SPAN'\r\n\r\n        if (previousNodeIsBr) {\r\n          setCaretPos((prv) => prv - 1)\r\n        }\r\n        if (previousNodeIsSpan) {\r\n          setCaretPos(\r\n            (prev) => prev - ((previousNode?.textContent?.length || 0) + zerowidthspaceLength),\r\n          )\r\n        }\r\n      }\r\n\r\n      if (\r\n        key === 'ArrowRight' &&\r\n        currentNode &&\r\n        nextNode &&\r\n        isZeroWidthSpace(currentNode.textContent?.at(currentOffset))\r\n      ) {\r\n        e.preventDefault()\r\n        const nextNodeIsBr = nextNode.nodeName === 'BR'\r\n        const nextNodeIsSpan = nextNode.nodeName === 'SPAN'\r\n\r\n        if (nextNodeIsBr) {\r\n          setCaretPos((prv) => prv + 1)\r\n        }\r\n        if (nextNodeIsSpan) {\r\n          setCaretPos(\r\n            (prev) => prev + ((previousNode?.textContent?.length || 0) + zerowidthspaceLength),\r\n          )\r\n        }\r\n      }\r\n\r\n      if (key === 'ArrowRight' && currentNode && isNextNodeBr) {\r\n        e.preventDefault()\r\n        setCaretPos((prv) => prv + 1)\r\n      }\r\n\r\n      if (\r\n        key === 'Backspace' &&\r\n        currentNode &&\r\n        isZeroWidthSpace(currentNode.textContent?.at(currentOffset - 1)) &&\r\n        currentNode.previousSibling?.nodeType === ELEMENT_NODE &&\r\n        editorRef.current\r\n      ) {\r\n        e.preventDefault()\r\n\r\n        editorRef.current.removeChild(currentNode.previousSibling)\r\n        currentNode.textContent = removeZeroWidthSpace(currentNode?.textContent || '')\r\n        updateContentAndCaret()\r\n      }\r\n\r\n      if (key === 'Enter') {\r\n        e.preventDefault()\r\n        if (multiline) {\r\n          insertContent({ type: 'line-break' })\r\n        }\r\n      }\r\n      onKeyDown?.(e)\r\n    }\r\n\r\n    const handleFocus = (e: FocusEvent<HTMLDivElement, Element>) => {\r\n      setCaretPosition(editorRef.current, caretPos)\r\n      onFocus?.(e)\r\n    }\r\n\r\n    const handleOnInput = (e: FormEvent<HTMLDivElement>) => {\r\n      updateContentAndCaret()\r\n\r\n      onInput?.(e)\r\n    }\r\n\r\n    function insertContent(content: MixInputType.MixInputValue | MixInputType.MixInputValue[]) {\r\n      if (window.getSelection()?.anchorNode?.parentElement !== editorRef.current) {\r\n        // editorRef.current?.focus()\r\n        // setCaretPosition(editorRef.current, caretPos)\r\n        // console.log('focus', window.getSelection()?.anchorNode?.parentElement)\r\n      }\r\n\r\n      const newContentHTML = tagValueArrToString({\r\n        tagClassName,\r\n        showTagDeleteBtn,\r\n        valueArr: Array.isArray(content) ? content : [content],\r\n      })\r\n\r\n      const { endNode, endOffset } = getCaretInfo(editorRef.current)\r\n\r\n      const isChildNodesEmpty = endNode === editorRef.current\r\n\r\n      if (!editorRef.current || !endNode || endNode == null) return\r\n      if (endNode === null) return\r\n\r\n      const [leftStr, rightStr] = split(endNode.textContent || '', endOffset)\r\n      const leftTextNode = document.createTextNode(leftStr)\r\n      const rightTextNode = document.createTextNode(rightStr)\r\n\r\n      const fragment = document.createDocumentFragment()\r\n      const tempElm = document.createElement('DIV')\r\n\r\n      tempElm.innerHTML = newContentHTML\r\n\r\n      fragment.append(leftTextNode)\r\n      Array.from(tempElm.childNodes).map((node) => fragment.append(node))\r\n      fragment.append(rightTextNode)\r\n\r\n      fragment.normalize()\r\n\r\n      if (isChildNodesEmpty) {\r\n        editorRef.current.append(fragment)\r\n      } else {\r\n        editorRef.current.replaceChild(fragment, endNode)\r\n      }\r\n\r\n      updateContentAndCaret()\r\n    }\r\n\r\n    return (\r\n      <>\r\n        <div\r\n          key={`${componentId}-mix-input`}\r\n          data-placeholder={placeholder}\r\n          aria-label=\"input\"\r\n          role=\"textbox\"\r\n          tabIndex={0}\r\n          className=\"mix-tag-input\"\r\n          contentEditable={readonly ? false : true}\r\n          ref={editorRef}\r\n          onInput={handleOnInput}\r\n          onKeyDown={handleKeyDown}\r\n          onSelect={handleSelectionChange}\r\n          onFocus={handleFocus}\r\n          dangerouslySetInnerHTML={{ __html: content }}\r\n          {...(multiline ? { 'aria-multiline': true } : {})}\r\n          {...restProps}\r\n        />\r\n      </>\r\n    )\r\n  },\r\n)\r\n\r\nexport default MixInput\r\n","import { type HTMLProps } from 'react'\r\n\r\nimport type { CreateTagParams, MixInputValue, Tag, TagValueArrToStringParams } from './MixInputType'\r\n\r\nexport const ELEMENT_NODE = 1\r\nconst TEXT_NODE = 3\r\n\r\nexport const MixInputValueTypes = {\r\n  TAG: 'tag',\r\n  LINE_BREAK: 'line-break',\r\n} as const\r\n\r\nexport function isTag(item: MixInputValue): item is Tag {\r\n  return typeof item === 'object' && item.type === MixInputValueTypes.TAG\r\n}\r\n\r\nexport function findPossibleCaretSetNodeAndIndex(elm: Element, targetPosition: number): {\r\n  node: ChildNode | undefined\r\n  nodeIndex: number | undefined\r\n  possibleCaretIndex: number | undefined\r\n} {\r\n  const nodesArr = Array.from(elm.childNodes)\r\n  const isNegativeTargetPosition = targetPosition < 0\r\n  if (!elm) {\r\n    return {\r\n      possibleCaretIndex: undefined,\r\n      node: undefined,\r\n      nodeIndex: undefined,\r\n    }\r\n  }\r\n\r\n  if (isNegativeTargetPosition) {\r\n    return {\r\n      possibleCaretIndex: 0,\r\n      node: isNegativeTargetPosition ? nodesArr[0] : undefined,\r\n      nodeIndex: isNegativeTargetPosition ? nodesArr.length : undefined,\r\n    }\r\n  }\r\n\r\n  let currentContentLength = 0\r\n  let previousNodesContentLength = 0\r\n\r\n  for (let i = 0; i < nodesArr.length; i++) {\r\n    const node = nodesArr[i]\r\n\r\n    if (node.nodeType !== ELEMENT_NODE && node.nodeType !== TEXT_NODE) {\r\n      console.error('invalid child node')\r\n      continue\r\n    }\r\n\r\n    currentContentLength += node.textContent?.length || 0\r\n\r\n    if (node.nodeType === TEXT_NODE && currentContentLength >= targetPosition) {\r\n      return {\r\n        node,\r\n        possibleCaretIndex: targetPosition - previousNodesContentLength,\r\n        nodeIndex: i,\r\n      }\r\n    }\r\n\r\n    if (node.nodeType === ELEMENT_NODE && currentContentLength >= targetPosition) {\r\n      return {\r\n        node: nodesArr[i + 1],\r\n        possibleCaretIndex: 1,\r\n        nodeIndex: i + 1,\r\n      }\r\n    }\r\n\r\n    previousNodesContentLength += node.textContent?.length || 0\r\n  }\r\n\r\n  return {\r\n    node: nodesArr.at(-1),\r\n    nodeIndex: nodesArr.length - 1,\r\n    possibleCaretIndex: nodesArr.at(-1)?.textContent?.length || 0,\r\n  }\r\n}\r\n\r\nfunction objToHtmlAttr(obj: HTMLProps<HTMLSpanElement>): string {\r\n  const keys = Object.keys(obj)\r\n  if (!keys.length) return ''\r\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n  return keys.reduce((acc, key) => acc += `${key}=\"${(obj as any)[key]}\" `, '')\r\n}\r\n\r\nexport function createTag({ props, tagClassName, showTagDeleteBtn }: CreateTagParams): string {\r\n  const { label, type, class: classes, ...restProps } = props\r\n  if (type !== 'tag') return ''\r\n\r\n  //&ZeroWidthSpace; is used to prevent the browser from collapsing multiple spaces into one\r\n  return `&ZeroWidthSpace;<span class=\"${tagClassName || ''} ${classes || ''}\" ${objToHtmlAttr(restProps)}contenteditable=\"false\">${label.trim()}${showTagDeleteBtn ? '<button class=\"mtag-delete-btn\" contenteditable=\"false\" tabindex=\"-1\">×</button>' : ''}</span>&ZeroWidthSpace;`\r\n}\r\n\r\nexport function isZeroWidthSpace(char: string | undefined | null) {\r\n  if (char === undefined || char === null || char === '') return false\r\n  return char.charCodeAt(0) === 8203\r\n}\r\n\r\nexport function removeZeroWidthSpace(str: string): string {\r\n  return str.replace(/[\\u200B]/g, '')\r\n}\r\n\r\nexport function setCaretPosition(elm: Element | null, targetCaretPos: number, isBrPlaced: boolean = false) {\r\n  if (!elm) return\r\n  let { node, possibleCaretIndex } = findPossibleCaretSetNodeAndIndex(elm, targetCaretPos)\r\n\r\n  if (isBrPlaced && node?.nextSibling?.nodeName === 'BR') {\r\n    node = node?.nextSibling.nextSibling || undefined\r\n    possibleCaretIndex = 0\r\n  }\r\n\r\n  const range = document.createRange()\r\n  const sel = window.getSelection()\r\n  if (!sel || !node || possibleCaretIndex === undefined) return\r\n\r\n  range.setStart(node, possibleCaretIndex)\r\n  range.collapse(true)\r\n  sel.removeAllRanges()\r\n  sel.addRange(range)\r\n}\r\n\r\nexport function getCaretInfo(element: HTMLElement | null) {\r\n  const caretInfo = {\r\n    range: undefined,\r\n    isCaretInSameNode: undefined,\r\n    endOffset: undefined,\r\n    startOffset: undefined,\r\n    startNode: undefined,\r\n    endNode: undefined,\r\n  }\r\n  if (!element || !window.getSelection) return caretInfo\r\n\r\n  const selection = window.getSelection()\r\n\r\n  if (element && selection?.rangeCount && selection.rangeCount > 0) {\r\n    const range = selection.getRangeAt(0)\r\n    return {\r\n      range,\r\n      isCaretInSameNode: range.endContainer === range.startContainer,\r\n      endOffset: range.endOffset,\r\n      startOffset: range.startOffset,\r\n      startNode: range.startContainer,\r\n      endNode: range.endContainer,\r\n    }\r\n  }\r\n  return caretInfo\r\n}\r\n\r\nexport function stripHtml(html: string) {\r\n  const div = document.createElement('DIV')\r\n  div.innerHTML = html\r\n  return div.innerText || div.textContent || ''\r\n}\r\n\r\nexport function createHtmlContent(contentStr: string) {\r\n  const div = document.createElement('div')\r\n  div.innerHTML = contentStr\r\n  return div.innerHTML\r\n}\r\n\r\nexport function getCaretPosition(element: HTMLElement | null) {\r\n  let caretOffset = 0\r\n\r\n  if (window.getSelection) {\r\n    const selection = window.getSelection()\r\n\r\n    if (element && selection?.rangeCount && selection.rangeCount > 0) {\r\n      const range = selection.getRangeAt(0)\r\n      const preCaretRange = range.cloneRange()\r\n      preCaretRange.selectNodeContents(element)\r\n      preCaretRange.setEnd(range.endContainer, range.endOffset)\r\n      caretOffset = preCaretRange.toString().length\r\n    }\r\n  }\r\n\r\n  return caretOffset\r\n}\r\n\r\nexport function tagValueArrToString({ tagClassName, valueArr, showTagDeleteBtn = false }: TagValueArrToStringParams): string {\r\n  if (!Array.isArray(valueArr)) {\r\n    console.error('[MixTagInput] Wrong value provided')\r\n    return ''\r\n  }\r\n  if (!valueArr.length) return ''\r\n\r\n  return valueArr.reduce((acc: string, item: MixInputValue) => {\r\n    if (typeof item === 'string') {\r\n      return (acc += item)\r\n    }\r\n    if (isTag(item)) {\r\n      return (acc += createTag({\r\n        props: item,\r\n        showTagDeleteBtn,\r\n        tagClassName,\r\n      }))\r\n    }\r\n    if (typeof item === 'object' && item.type === 'line-break') {\r\n      // return (acc += '<br>&ZeroWidthSpace;')\r\n      return (acc += '<br>')\r\n    }\r\n    return ''\r\n  }, '')\r\n}\r\n\r\n\r\nexport function nodesToArray(nodes: NodeList | undefined, tagClassName: string = ''): MixInputValue[] {\r\n  if (!nodes) return []\r\n\r\n  const nodeArr = Array.from(nodes)\r\n  const arr: MixInputValue[] = []\r\n\r\n  for (let i = 0; i < nodeArr.length; i += 1) {\r\n    const arrItem: Node | HTMLElement = nodeArr[i]\r\n    const lastItem: MixInputValue | undefined = arr.at(-1)\r\n    if (\r\n      arrItem.nodeType === TEXT_NODE &&\r\n      arrItem instanceof Node &&\r\n      arrItem.textContent !== '\\n' &&\r\n      arrItem.textContent !== '' &&\r\n      removeZeroWidthSpace(arrItem.textContent || '') !== ''\r\n    ) {\r\n      const content = removeZeroWidthSpace(arrItem.textContent || '')\r\n\r\n      if (typeof lastItem === 'string') {\r\n        arr[arr.length - 1] = lastItem + content\r\n      } else {\r\n        arr.push(content || '')\r\n      }\r\n    }\r\n    if (arrItem.nodeType === ELEMENT_NODE && arrItem instanceof HTMLElement && arrItem.nodeName === 'SPAN') {\r\n      const attrs: { [key: string]: string } = {}\r\n\r\n      for (let i = 0; i < arrItem.attributes.length; i++) {\r\n        const attr = arrItem.attributes[i]\r\n\r\n        if (attr.nodeName === 'class') {\r\n          const classes = attr.nodeValue?.replaceAll(new RegExp(tagClassName, 'g'), '').trim()\r\n          if (classes === '') {\r\n            continue\r\n          } else if (classes) {\r\n            attrs[attr.nodeName] = classes\r\n            continue\r\n          }\r\n        }\r\n        if (attr.nodeName === 'contenteditable') {\r\n          continue\r\n        }\r\n        if (attr.nodeName && attr.nodeValue) {\r\n          attrs[attr.nodeName] = attr.nodeValue\r\n        }\r\n      }\r\n\r\n      arr.push({\r\n        type: MixInputValueTypes.TAG,\r\n        label: arrItem.textContent || '',\r\n        ...attrs,\r\n      })\r\n    }\r\n\r\n    if (arrItem instanceof HTMLElement && arrItem.nodeName === 'BR') {\r\n      arr.push({ type: MixInputValueTypes.LINE_BREAK })\r\n    }\r\n  }\r\n\r\n  return arr\r\n}\r\n\r\n\r\nexport function split(str: string, index: number) {\r\n  const result = [str.slice(0, index), str.slice(index)]\r\n\r\n  return result\r\n}\r\n","import MixInput from './MixInput'\r\nimport type { MixInputProps, MixInputRef, MixInputValues } from './MixInputType.d'\r\nexport default MixInput\r\n\r\n\r\nexport type {\r\n  MixInputProps,\r\n  MixInputRef,\r\n  MixInputValues,\r\n}\r\n"],"mappings":"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","names":["React","forwardRef","useEffect","useId","useImperativeHandle","useRef","useState","ELEMENT_NODE","TEXT_NODE","MixInputValueTypes","isTag","item","findPossibleCaretSetNodeAndIndex","elm","targetPosition","_a","_b","_c","_d","nodesArr","isNegativeTargetPosition","currentContentLength","previousNodesContentLength","i","node","objToHtmlAttr","obj","keys","acc","key","createTag","props","tagClassName","showTagDeleteBtn","label","type","classes","restProps","isZeroWidthSpace","char","removeZeroWidthSpace","str","setCaretPosition","targetCaretPos","isBrPlaced","possibleCaretIndex","range","sel","getCaretInfo","element","caretInfo","selection","stripHtml","html","div","createHtmlContent","contentStr","getCaretPosition","caretOffset","preCaretRange","tagValueArrToString","valueArr","nodesToArray","nodes","nodeArr","arr","arrItem","lastItem","content","attrs","attr","split","index","MixInput","forwardRef","props","ref","onChange","onInput","onKeyDown","onSelect","onFocus","value","multiline","placeholder","showTagDeleteBtn","readonly","tagClassName","restProps","componentId","useId","content","setContent","useState","editorRef","useRef","caretPos","setCaretPos","useImperativeHandle","insertContent","useEffect","updateContentAndCaret","tagValueArrToString","setCaretPosition","newHtmlContent","triggerOnchange","_a","element","isHtmlContentPassed","newContent","createHtmlContent","newContentText","stripHtml","isZeroWidthSpaceRemovedFromFirst","isZeroWidthSpace","updatedCaret","updatedContent","prev","nodesToArray","handleSelectionChange","e","currentNode","getCaretInfo","previousNode","nextNode","isNextNodeIsSpan","getCaretPosition","handleKeyDown","_b","_c","_d","key","currentOffset","isNextNodeBr","zerowidthspaceLength","previousNodeIsBr","previousNodeIsSpan","prv","nextNodeIsBr","nextNodeIsSpan","ELEMENT_NODE","removeZeroWidthSpace","handleFocus","handleOnInput","newContentHTML","endNode","endOffset","isChildNodesEmpty","leftStr","rightStr","split","leftTextNode","rightTextNode","fragment","tempElm","node","React","MixInput_default","src_default","MixInput_default"]}