{"version":3,"sources":["../src/MixInput.tsx","../src/utils.ts","../src/index.ts"],"sourcesContent":["import './MixInput.css'\r\n\r\nimport React, {\r\n  type ForwardedRef,\r\n  forwardRef,\r\n  type KeyboardEvent,\r\n  type MouseEvent,\r\n  type SyntheticEvent,\r\n  useEffect,\r\n  useImperativeHandle,\r\n  useRef,\r\n} from 'react'\r\n\r\nimport type { MixInputProps, MixInputRef, MixInputValue } from './MixInputType'\r\nimport { DEFAULT_TAG_CLASS, nodesToArray, tagValueArrToString } from './utils'\r\n\r\nconst MixInput = forwardRef((props: MixInputProps, ref: ForwardedRef<MixInputRef>) => {\r\n  const { onChange, onClick, value, multiline, placeholder, showTagDeleteBtn = true, readonly = false, ...restProps } = props\r\n  const contentRef = useRef(tagValueArrToString(value, showTagDeleteBtn))\r\n  const editorRef = useRef<HTMLDivElement | null>(null)\r\n\r\n  useEffect(() => {\r\n    if (!editorRef.current) return\r\n    editorRef.current.innerHTML = tagValueArrToString(value, showTagDeleteBtn)\r\n  }, [value])\r\n\r\n  const insertContent = (newContent: MixInputValue) => {\r\n    const selection = window.getSelection()\r\n    if (!selection) {\r\n      return\r\n    }\r\n\r\n    const range = selection.getRangeAt(0)\r\n\r\n    if (range.commonAncestorContainer !== editorRef.current && range.commonAncestorContainer.parentElement !== editorRef.current) {\r\n      return\r\n    }\r\n\r\n    range.deleteContents()\r\n\r\n    let node: HTMLSpanElement | Text | null = null\r\n    if (typeof newContent === 'string') {\r\n      node = document.createTextNode(newContent)\r\n      node.textContent = newContent\r\n    } else if (typeof newContent === 'object' && newContent.type === 'tag') {\r\n      node = document.createElement('span')\r\n      node.classList.add(DEFAULT_TAG_CLASS)\r\n      if (newContent.classes) {\r\n        node.classList.add(newContent.classes)\r\n      }\r\n      node.setAttribute('contentEditable', 'false')\r\n      node.innerHTML = newContent.label\r\n\r\n      if (showTagDeleteBtn) {\r\n        const deleteBtn = document.createElement('button')\r\n        deleteBtn.classList.add('mtag-delete-btn')\r\n        deleteBtn.setAttribute('contentEditable', 'false')\r\n        deleteBtn.setAttribute('tabIndex', '-1')\r\n        deleteBtn.innerHTML = '&times;'\r\n        node.appendChild(deleteBtn)\r\n      }\r\n    }\r\n\r\n    if (!node) {\r\n      console.error('invalid content')\r\n      return\r\n    }\r\n\r\n    range.insertNode(node)\r\n    const newRange = document.createRange()\r\n    newRange.setStartAfter(node)\r\n    newRange.setEndAfter(node)\r\n    selection.removeAllRanges()\r\n    selection.addRange(newRange)\r\n    editorRef.current?.focus()\r\n\r\n    contentRef.current = editorRef.current?.innerHTML ?? ''\r\n    onChange?.(nodesToArray(editorRef.current?.childNodes))\r\n  }\r\n\r\n  useImperativeHandle(ref, () => ({\r\n    inputRef: editorRef.current,\r\n    insertContent,\r\n    getValue: () => nodesToArray(editorRef.current?.childNodes),\r\n  }))\r\n\r\n  const handleContentChange = () => {\r\n    if (editorRef.current) {\r\n      contentRef.current = editorRef.current.innerHTML\r\n    }\r\n    onChange?.(nodesToArray(editorRef.current?.childNodes))\r\n  }\r\n\r\n  const handleKeyDown = (e: KeyboardEvent<HTMLDivElement>) => {\r\n    if (e.key === 'Enter' && !multiline) {\r\n      e.preventDefault()\r\n    }\r\n  }\r\n\r\n  const handleClicks = (e: SyntheticEvent) => {\r\n    if (e.target instanceof HTMLButtonElement && e.target.classList.contains('mtag-delete-btn')) {\r\n      e.target?.parentElement?.remove()\r\n      onChange?.(nodesToArray(editorRef.current?.childNodes))\r\n    }\r\n    onClick?.(e as MouseEvent<HTMLDivElement>)\r\n  }\r\n\r\n  return (\r\n    <div\r\n      data-placeholder={placeholder}\r\n      aria-label=\"input\"\r\n      role=\"textbox\"\r\n      tabIndex={0}\r\n      className=\"mix-tag-input\"\r\n      contentEditable={readonly ? false : true}\r\n      ref={editorRef}\r\n      onInput={handleContentChange}\r\n      onKeyDown={handleKeyDown}\r\n      onClick={handleClicks}\r\n      dangerouslySetInnerHTML={{ __html: contentRef.current }}\r\n      {...(multiline ? { 'aria-multiline': true } : {})}\r\n      {...restProps}\r\n    />\r\n  )\r\n})\r\n\r\nexport default MixInput\r\n","import { type MixInputValue } from './MixInputType'\r\n\r\nexport const DEFAULT_TAG_CLASS = 'mtag'\r\n\r\nexport function nodesToArray(nodes: NodeList | undefined): MixInputValue[] {\r\n  if (!nodes) return []\r\n\r\n  const nodeArr = Array.from(nodes)\r\n  const arr: MixInputValue[] = []\r\n\r\n  for (let i = 0; i < nodeArr.length; i += 1) {\r\n    const arrItem: Node | HTMLElement = nodeArr[i]\r\n    const lastItem: MixInputValue | undefined = arr.at(-1)\r\n    if (\r\n      arrItem instanceof Node &&\r\n      arrItem.nodeName === '#text' &&\r\n      arrItem.textContent !== '\\n' &&\r\n      arrItem.textContent !== ''\r\n    ) {\r\n      if (typeof lastItem === 'string') {\r\n        arr[arr.length - 1] = lastItem + arrItem.textContent\r\n      } else {\r\n        arr.push(arrItem.textContent || '')\r\n      }\r\n    }\r\n    if (arrItem instanceof HTMLElement && arrItem.nodeName === 'SPAN') {\r\n      const classes = arrItem?.classList?.value.replace(DEFAULT_TAG_CLASS, '').trim()\r\n      arr.push({\r\n        type: 'tag',\r\n        label: arrItem.innerHTML || arrItem.innerText,\r\n        ...(classes ? { classes } : {}),\r\n      })\r\n    }\r\n  }\r\n\r\n  return arr\r\n}\r\n\r\nexport function tagValueArrToString(valueArr: MixInputValue[] | undefined, isTagDeletable = false): string {\r\n  if (!Array.isArray(valueArr) || valueArr.length === 0) {\r\n    return ''\r\n  }\r\n\r\n  return valueArr.reduce((acc: string, item: MixInputValue) => {\r\n    if (typeof item === 'string') {\r\n      return (acc += item)\r\n    }\r\n    if (typeof item === 'object') {\r\n      const { label, classes } = item\r\n      return (acc += `<span class=\"${DEFAULT_TAG_CLASS} ${classes || ''\r\n        }\" contenteditable=\"false\">${label} ${isTagDeletable ? '<button class=\"mtag-delete-btn\" contenteditable=\"false\" tabindex=\"-1\">Ã—</button>' : ''}</span>`)\r\n    }\r\n    return ''\r\n  }, '')\r\n}\r\n\r\nexport function getCaretOffset(element: HTMLElement | null): number {\r\n  let caretOffset = 0\r\n  const sel = window.getSelection()\r\n\r\n  if (sel?.rangeCount && element) {\r\n    const range = sel.getRangeAt(0)\r\n    const preCaretRange = range.cloneRange()\r\n    preCaretRange.selectNodeContents(element)\r\n    preCaretRange.setEnd(range.endContainer, range.endOffset)\r\n    caretOffset = preCaretRange.toString().length\r\n  }\r\n  return caretOffset\r\n}\r\n","import MixInput from './MixInput'\r\nimport type { MixInputProps, MixInputRef, MixInputValue } from './MixInputType.d'\r\nexport default MixInput\r\n\r\n\r\nexport type {\r\n  MixInputProps,\r\n  MixInputRef,\r\n  MixInputValue,\r\n}\r\n"],"mappings":"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","names":["React","forwardRef","useEffect","useImperativeHandle","useRef","DEFAULT_TAG_CLASS","nodesToArray","nodes","_a","nodeArr","arr","arrItem","lastItem","classes","tagValueArrToString","valueArr","isTagDeletable","acc","item","label","MixInput","forwardRef","props","ref","onChange","onClick","value","multiline","placeholder","showTagDeleteBtn","readonly","restProps","contentRef","useRef","tagValueArrToString","editorRef","useEffect","insertContent","newContent","_a","_b","_c","selection","range","node","DEFAULT_TAG_CLASS","deleteBtn","newRange","nodesToArray","useImperativeHandle","React","MixInput_default","src_default","MixInput_default"]}