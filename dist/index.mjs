"use client";
import L,{forwardRef as R,useEffect as E,useImperativeHandle as b,useRef as I}from"react";var f="mtag";function d(i){var a;if(!i)return[];let s=Array.from(i),e=[];for(let u=0;u<s.length;u+=1){let r=s[u],l=e.at(-1);if(r instanceof Node&&r.nodeName==="#text"&&r.textContent!==`
`&&r.textContent!==""&&(typeof l=="string"?e[e.length-1]=l+r.textContent:e.push(r.textContent||"")),r instanceof HTMLElement&&r.nodeName==="SPAN"){let n=(a=r==null?void 0:r.classList)==null?void 0:a.value.replace(f,"").trim();e.push({type:"tag",label:r.innerHTML||r.innerText,...n?{classes:n}:{}})}}return e}function m(i){return!Array.isArray(i)||i.length===0?"":i.reduce((s,e)=>{if(typeof e=="string")return s+=e;if(typeof e=="object"){let{label:a,classes:u}=e;return s+=`<span class="${f} ${u||""}" contenteditable="false">${a}</span>`}return""},"")}var h=R((i,s)=>{let{onChange:e,value:a,multiline:u,...r}=i,l=I(m(a)),n=I(null);E(()=>{n.current&&(n.current.innerHTML=m(a))},[a]);let A=t=>{var g,M,y;let c=window.getSelection();if(!c)return;let p=c.getRangeAt(0);if(p.commonAncestorContainer!==n.current&&p.commonAncestorContainer.parentElement!==n.current)return;p.deleteContents();let o;if(typeof t=="string"?(o=document.createTextNode(t),o.textContent=t):typeof t=="object"&&t.type==="tag"&&(o=document.createElement("span"),o.classList.add(f),t.classes&&o.classList.add(t.classes),o.setAttribute("contentEditable","false"),o.innerHTML=t.label),!o){console.error("invalid content");return}p.insertNode(o);let x=document.createRange();x.setStartAfter(o),x.setEndAfter(o),c.removeAllRanges(),c.addRange(x),(g=n.current)==null||g.focus(),l.current=((M=n.current)==null?void 0:M.innerHTML)??"",e==null||e(d((y=n.current)==null?void 0:y.childNodes))};return b(s,()=>({inputRef:n.current,insertContent:A,getValue:()=>{var t;return d((t=n.current)==null?void 0:t.childNodes)}})),L.createElement("div",{"aria-label":"input",role:"textbox",tabIndex:0,className:"mix-tag-input",contentEditable:!0,ref:n,onInput:()=>{var t;n.current&&(l.current=n.current.innerHTML),e==null||e(d((t=n.current)==null?void 0:t.childNodes))},onKeyDown:t=>{t.key==="Enter"&&!u&&t.preventDefault()},dangerouslySetInnerHTML:{__html:l.current},...u?{"aria-multiline":!0}:{},...r})}),T=h;var w=T;export{w as default};
//# sourceMappingURL=index.mjs.map