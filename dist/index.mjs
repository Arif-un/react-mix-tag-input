"use client";
import T,{forwardRef as N,useEffect as E,useImperativeHandle as A,useRef as C}from"react";function M(r){return typeof r=="object"&&r.type==="tag"}function V(r){return{type:"tag",attrs:{...r.attrs}}}function l(r){let a=[];return r.forEach(t=>{var n;t.type==="paragraph"&&(a.push([]),(n=t==null?void 0:t.content)==null||n.forEach(e=>{var o,s;e.type==="text"&&e.text&&((o=a.at(-1))==null||o.push(e.text)),e.type==="tag"&&((s=a.at(-1))==null||s.push(V(e)))}))}),a}function d(r){let a=[];return r.forEach((t,n)=>{Array.isArray(a[n])||a.push({type:"paragraph",content:[]});let e=a.at(-1);typeof t=="string"&&(e!=null&&e.content)&&e.content.push({type:"text",text:t}),!Array.isArray(t)&&M(t)&&(e!=null&&e.content)&&e.content.push({type:"tag",attrs:{...t.attrs}}),Array.isArray(t)&&t.forEach(o=>{typeof o=="string"&&(e!=null&&e.content)&&e.content.push({type:"text",text:o}),typeof o=="object"&&o.type==="tag"&&(e!=null&&e.content)&&e.content.push({type:"tag",attrs:{...o.attrs}})})}),a}import{EditorContent as O,useEditor as R}from"@tiptap/react";import P from"@tiptap/extension-document";import J from"@tiptap/extension-paragraph";import L from"@tiptap/extension-text";import S from"@tiptap/extension-placeholder";import{mergeAttributes as b,Node as I}from"@tiptap/core";var f=I.create({name:"tag",group:"inline",inline:!0,atom:!0,selectable:!1,parseHTML(){return[{tag:`span[data-type="${this.name}"]`}]},renderHTML({HTMLAttributes:r}){return["span",b(r)]},addNodeView:()=>({node:r,extension:a})=>{let t=document.createElement("span");t.className="mi-tag",t.innerHTML=r.attrs.label,t.setAttribute("data-type","tag"),r.attrs.id&&t.setAttribute("data-id",r.attrs.id),a.options.tagClassName&&t.classList.add(a.options.tagClassName),r.attrs.class&&(Array.isArray(r.attrs.class)?r.attrs.class.forEach(e=>{t.classList.add(e)}):t.classList.add(r.attrs.class)),r.attrs.style&&Object.assign(t.style,r.attrs.style);let n=document.createElement("span");return n.appendChild(t),n.appendChild(document.createTextNode("\u200B")),{dom:n}},addAttributes(){return{label:void 0,id:void 0,class:void 0,style:void 0}}});var H=N((r,a)=>{let{onChange:t,value:n,placeholder:e,readonly:o=!1,tagClassName:s,editorOptions:g,className:m,...y}=r,u=C(null),i=R({editorProps:{attributes:{class:`mix-input ${m}`,...y}},extensions:[P,J.configure({HTMLAttributes:{class:"mi-paragraph"}}),L,S.configure({placeholder:e}),f.configure({tagClassName:s})],onUpdate:({editor:p})=>{var c;t==null||t(l(((c=p==null?void 0:p.getJSON())==null?void 0:c.content)||[]))},...g}),h=p=>{i==null||i.chain().focus().insertContent(p).run()};return E(()=>{let p=d(n);p.length===0&&(p=[{type:"paragraph"}]),JSON.stringify(p)!==JSON.stringify(i==null?void 0:i.getJSON().content)&&(i==null||i.commands.setContent(p))},[n]),A(a,()=>({element:u.current,editor:i,insertContent:h})),T.createElement(O,{editor:i,innerRef:u})}),x=H;var Y=x;export{Y as default};
//# sourceMappingURL=index.mjs.map