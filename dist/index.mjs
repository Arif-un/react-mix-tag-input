"use client";
import H,{forwardRef as v,useEffect as S,useImperativeHandle as N,useRef as I}from"react";var x="mtag";function f(s){var a;if(!s)return[];let c=Array.from(s),t=[];for(let i=0;i<c.length;i+=1){let n=c[i],m=t.at(-1);if(n instanceof Node&&n.nodeName==="#text"&&n.textContent!==`
`&&n.textContent!==""&&(typeof m=="string"?t[t.length-1]=m+n.textContent:t.push(n.textContent||"")),n instanceof HTMLElement&&n.nodeName==="SPAN"){let d=(a=n==null?void 0:n.classList)==null?void 0:a.value.replace(x,"").trim();t.push({type:"tag",label:n.innerHTML||n.innerText,...d?{classes:d}:{}})}}return t}function y(s,c=!1){return!Array.isArray(s)||s.length===0?"":s.reduce((t,a)=>{if(typeof a=="string")return t+=a;if(typeof a=="object"){let{label:i,classes:n}=a;return t+=`<span class="${x} ${n||""}" contenteditable="false">${i} ${c?'<button class="mtag-delete-btn" contenteditable="false" tabindex="-1">\xD7</button>':""}</span>`}return""},"")}var V=v((s,c)=>{let{onChange:t,onClick:a,value:i,multiline:n,placeholder:m,showTagDeleteBtn:d=!0,readonly:A=!1,...h}=s,g=I(y(i,d)),o=I(null);S(()=>{o.current&&(o.current.innerHTML=y(i,d))},[i]);let R=e=>{var T,b,E;let l=window.getSelection();if(!l)return;let u=l.getRangeAt(0);if(u.commonAncestorContainer!==o.current&&u.commonAncestorContainer.parentElement!==o.current)return;u.deleteContents();let r=null;if(typeof e=="string")r=document.createTextNode(e),r.textContent=e;else if(typeof e=="object"&&e.type==="tag"&&(r=document.createElement("span"),r.classList.add(x),e.classes&&r.classList.add(e.classes),r.setAttribute("contentEditable","false"),r.innerHTML=e.label,d)){let p=document.createElement("button");p.classList.add("mtag-delete-btn"),p.setAttribute("contentEditable","false"),p.setAttribute("tabIndex","-1"),p.innerHTML="&times;",r.appendChild(p)}if(!r){console.error("invalid content");return}u.insertNode(r);let M=document.createRange();M.setStartAfter(r),M.setEndAfter(r),l.removeAllRanges(),l.addRange(M),(T=o.current)==null||T.focus(),g.current=((b=o.current)==null?void 0:b.innerHTML)??"",t==null||t(f((E=o.current)==null?void 0:E.childNodes))};return N(c,()=>({inputRef:o.current,insertContent:R,getValue:()=>{var e;return f((e=o.current)==null?void 0:e.childNodes)}})),H.createElement("div",{"data-placeholder":m,"aria-label":"input",role:"textbox",tabIndex:0,className:"mix-tag-input",contentEditable:!A,ref:o,onInput:()=>{var e;o.current&&(g.current=o.current.innerHTML),t==null||t(f((e=o.current)==null?void 0:e.childNodes))},onKeyDown:e=>{e.key==="Enter"&&!n&&e.preventDefault()},onClick:e=>{var l,u,r;e.target instanceof HTMLButtonElement&&e.target.classList.contains("mtag-delete-btn")&&((u=(l=e.target)==null?void 0:l.parentElement)==null||u.remove(),t==null||t(f((r=o.current)==null?void 0:r.childNodes))),a==null||a(e)},dangerouslySetInnerHTML:{__html:g.current},...n?{"aria-multiline":!0}:{},...h})}),L=V;var j=L;export{j as default};
//# sourceMappingURL=index.mjs.map