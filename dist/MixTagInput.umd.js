(function(o,f){typeof exports=="object"&&typeof module<"u"?f(require("react")):typeof define=="function"&&define.amd?define(["react"],f):(o=typeof globalThis<"u"?globalThis:o||self,f(o.React))})(this,function(o){"use strict";const f="",p="mtag";function g(i){var c;if(!i)return[];const l=Array.from(i),e=[];for(let a=0;a<l.length;a+=1){const n=l[a],u=e.at(-1);if(n instanceof Node&&n.nodeName==="#text"&&n.textContent!==`
`&&n.textContent!==""&&(typeof u=="string"?e[e.length-1]=u+n.textContent:e.push(n.textContent||"")),n instanceof HTMLElement&&n.nodeName==="SPAN"){const r=(c=n==null?void 0:n.classList)==null?void 0:c.value.replace(p,"").trim();e.push({type:"tag",label:n.innerHTML||n.innerText,...r?{classes:r}:{}})}}return e}function y(i){return!Array.isArray(i)||i.length===0?"":i.reduce((l,e)=>{if(typeof e=="string")return l+=e;if(typeof e=="object"){const{label:c,classes:a}=e;return l+=`<span class="${p} ${a||""}" contenteditable="false">${c}</span>`}return""},"")}o.forwardRef((i,l)=>{const{onChange:e,value:c,multiline:a,...n}=i,u=o.useRef(y(c)),r=o.useRef(null);o.useEffect(()=>{r.current&&(r.current.innerHTML=y(c))},[c]);const h=t=>{var x,b,A;const d=window.getSelection();if(!d)return;const T=d.getRangeAt(0);T.deleteContents();let s;if(typeof t=="string"?(s=document.createTextNode(t),s.textContent=t):typeof t=="object"&&t.type==="tag"&&(s=document.createElement("span"),s.classList.add(p),t.classes&&s.classList.add(t.classes),s.setAttribute("contentEditable","false"),s.innerHTML=t.label),!s){console.error("invalid content");return}T.insertNode(s);const m=document.createRange();m.setStartAfter(s),m.setEndAfter(s),d.removeAllRanges(),d.addRange(m),(x=r.current)==null||x.focus(),u.current=((b=r.current)==null?void 0:b.innerHTML)??"",e==null||e(g((A=r.current)==null?void 0:A.childNodes))};o.useImperativeHandle(l,()=>({inputRef:r.current,insertContent:h,getValue:()=>{var t;return g((t=r.current)==null?void 0:t.childNodes)}}));const L=()=>{var t;r.current&&(u.current=r.current.innerHTML),e==null||e(g((t=r.current)==null?void 0:t.childNodes))},N=t=>{t.key==="Enter"&&!a&&t.preventDefault()};return o.createElement("div",{"aria-label":"input",role:"textbox",tabIndex:0,className:"mix-tag-input",contentEditable:!0,ref:r,onInput:L,onKeyDown:N,dangerouslySetInnerHTML:{__html:u.current},...a?{"aria-multiline":!0}:{},...n})})});
