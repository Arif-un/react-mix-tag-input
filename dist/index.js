"use client";
"use strict";var ie=Object.create;var O=Object.defineProperty;var ae=Object.getOwnPropertyDescriptor;var se=Object.getOwnPropertyNames;var de=Object.getPrototypeOf,le=Object.prototype.hasOwnProperty;var ue=(e,n)=>{for(var r in n)O(e,r,{get:n[r],enumerable:!0})},z=(e,n,r,t)=>{if(n&&typeof n=="object"||typeof n=="function")for(let o of se(n))!le.call(e,o)&&o!==r&&O(e,o,{get:()=>n[o],enumerable:!(t=ae(n,o))||t.enumerable});return e};var pe=(e,n,r)=>(r=e!=null?ie(de(e)):{},z(n||!e||!e.__esModule?O(r,"default",{value:e,enumerable:!0}):r,e)),ce=e=>z(O({},"__esModule",{value:!0}),e);var Ce={};ue(Ce,{default:()=>he});module.exports=ce(Ce);var p=pe(require("react"));var R=1,$=3,_={TAG:"tag",LINE_BREAK:"line-break"};function fe(e){return typeof e=="object"&&e.type===_.TAG}function ge(e,n){var a,h,b,y;let r=Array.from(e.childNodes),t=n<0;if(!e)return{possibleCaretIndex:void 0,node:void 0,nodeIndex:void 0};if(t)return{possibleCaretIndex:0,node:t?r[0]:void 0,nodeIndex:t?r.length:void 0};let o=0,f=0;for(let d=0;d<r.length;d++){let g=r[d];if(g.nodeType!==R&&g.nodeType!==$){console.error("invalid child node");continue}if(o+=((a=g.textContent)==null?void 0:a.length)||0,g.nodeType===$&&o>=n)return{node:g,possibleCaretIndex:n-f,nodeIndex:d};if(g.nodeType===R&&o>=n)return{node:r[d+1],possibleCaretIndex:1,nodeIndex:d+1};f+=((h=g.textContent)==null?void 0:h.length)||0}return{node:r.at(-1),nodeIndex:r.length-1,possibleCaretIndex:((y=(b=r.at(-1))==null?void 0:b.textContent)==null?void 0:y.length)||0}}function xe(e){let n=Object.keys(e);return n.length?n.reduce((r,t)=>r+=`${t}="${e[t]}" `,""):""}function me({props:e,tagClassName:n,showTagDeleteBtn:r}){let{label:t,type:o,class:f,...a}=e;return o!=="tag"?"":`&ZeroWidthSpace;<span class="${n||""} ${f||""}" ${xe(a)}contenteditable="false">${t.trim()}${r?'<button class="mtag-delete-btn" contenteditable="false" tabindex="-1">\xD7</button>':""}</span>&ZeroWidthSpace;`}function A(e){return e==null||e===""?!1:e.charCodeAt(0)===8203}function k(e){return e.replace(/[\u200B]/g,"")}function K(e,n,r=!1){var h;if(!e)return;let{node:t,possibleCaretIndex:o}=ge(e,n);r&&((h=t==null?void 0:t.nextSibling)==null?void 0:h.nodeName)==="BR"&&(t=(t==null?void 0:t.nextSibling.nextSibling)||void 0,o=0);let f=document.createRange(),a=window.getSelection();!a||!t||o===void 0||(f.setStart(t,o),f.collapse(!0),a.removeAllRanges(),a.addRange(f))}function B(e){let n={range:void 0,isCaretInSameNode:void 0,endOffset:void 0,startOffset:void 0,startNode:void 0,endNode:void 0};if(!e||!window.getSelection)return n;let r=window.getSelection();if(e&&(r!=null&&r.rangeCount)&&r.rangeCount>0){let t=r.getRangeAt(0);return{range:t,isCaretInSameNode:t.endContainer===t.startContainer,endOffset:t.endOffset,startOffset:t.startOffset,startNode:t.startContainer,endNode:t.endContainer}}return n}function W(e){let n=document.createElement("DIV");return n.innerHTML=e,n.innerText||n.textContent||""}function G(e){let n=document.createElement("div");return n.innerHTML=e,n.innerHTML}function X(e){let n=0;if(window.getSelection){let r=window.getSelection();if(e&&(r!=null&&r.rangeCount)&&r.rangeCount>0){let t=r.getRangeAt(0),o=t.cloneRange();o.selectNodeContents(e),o.setEnd(t.endContainer,t.endOffset),n=o.toString().length}}return n}function F({tagClassName:e,valueArr:n,showTagDeleteBtn:r=!1}){return Array.isArray(n)?n.length?n.reduce((t,o)=>typeof o=="string"?t+=o:fe(o)?t+=me({props:o,showTagDeleteBtn:r,tagClassName:e}):typeof o=="object"&&o.type==="line-break"?t+="<br>":"",""):"":(console.error("[MixTagInput] Wrong value provided"),"")}function q(e,n=""){var o;if(!e)return[];let r=Array.from(e),t=[];for(let f=0;f<r.length;f+=1){let a=r[f],h=t.at(-1);if(a.nodeType===$&&a instanceof Node&&a.textContent!==`
`&&a.textContent!==""&&k(a.textContent||"")!==""){let b=k(a.textContent||"");typeof h=="string"?t[t.length-1]=h+b:t.push(b||"")}if(a.nodeType===R&&a instanceof HTMLElement&&a.nodeName==="SPAN"){let b={};for(let y=0;y<a.attributes.length;y++){let d=a.attributes[y];if(d.nodeName==="class"){let g=(o=d.nodeValue)==null?void 0:o.replaceAll(new RegExp(n,"g"),"").trim();if(g==="")continue;if(g){b[d.nodeName]=g;continue}}d.nodeName!=="contenteditable"&&d.nodeName&&d.nodeValue&&(b[d.nodeName]=d.nodeValue)}t.push({type:_.TAG,label:a.textContent||"",...b})}a instanceof HTMLElement&&a.nodeName==="BR"&&t.push({type:_.LINE_BREAK})}return t}function J(e,n){return[e.slice(0,n),e.slice(n)]}var be=(0,p.forwardRef)((e,n)=>{let{onChange:r,onInput:t,onKeyDown:o,onSelect:f,onFocus:a,value:h,multiline:b,placeholder:y,showTagDeleteBtn:d=!1,readonly:g=!1,tagClassName:P="mtag",...U}=e,Y=(0,p.useId)(),[Z,ee]=(0,p.useState)(""),c=(0,p.useRef)(null),[V,I]=(0,p.useState)(999);(0,p.useImperativeHandle)(n,()=>({element:c.current,caretPosition:V,insertContent:j})),(0,p.useEffect)(()=>{D({triggerOnchange:!1,newHtmlContent:F({valueArr:h,showTagDeleteBtn:d,tagClassName:P})})},[h,P,d,F]),(0,p.useEffect)(()=>{K(c.current,V)},[V]);let D=({newHtmlContent:s,triggerOnchange:l=!0}={})=>{var M;let i=c.current;if(!i)return;let x=s!==void 0,u=x?G(s):i.innerHTML,m=x?W(u):i.innerText,T=x&&A(Z.charAt(1)),E=W(m).length-W(Z).length;T&&(E=0);let C=u.startsWith("<span")?"&ZeroWidthSpace;"+u:u;ee(C),T||I(N=>N+E),l&&(r==null||r(q((M=c.current)==null?void 0:M.childNodes,P)))},te=s=>{var T;f==null||f(s);let{endNode:l}=B(c.current),i=l==null?void 0:l.previousSibling,x=l==null?void 0:l.nextSibling,u=(x==null?void 0:x.nodeName)==="SPAN",m=X(c.current);u&&i===null&&m===1&&A((T=l==null?void 0:l.textContent)==null?void 0:T.at(0))?I(0):I(m)},ne=s=>{var w,C,M,N;let l=s.key,{endNode:i,endOffset:x}=B(c.current),u=i==null?void 0:i.previousSibling,m=i==null?void 0:i.nextSibling,T=(m==null?void 0:m.nodeName)==="BR",E=2;if(l==="ArrowLeft"&&i&&u&&A((w=i.textContent)==null?void 0:w.at(x-1))){s.preventDefault();let S=u.nodeName==="BR",L=u.nodeName==="SPAN";S&&I(v=>v-1),L&&I(v=>{var H;return v-((((H=u==null?void 0:u.textContent)==null?void 0:H.length)||0)+E)})}if(l==="ArrowRight"&&i&&m&&A((C=i.textContent)==null?void 0:C.at(x))){s.preventDefault();let S=m.nodeName==="BR",L=m.nodeName==="SPAN";S&&I(v=>v+1),L&&I(v=>{var H;return v+((((H=u==null?void 0:u.textContent)==null?void 0:H.length)||0)+E)})}l==="ArrowRight"&&i&&T&&(s.preventDefault(),I(S=>S+1)),l==="Backspace"&&i&&A((M=i.textContent)==null?void 0:M.at(x-1))&&((N=i.previousSibling)==null?void 0:N.nodeType)===R&&c.current&&(s.preventDefault(),c.current.removeChild(i.previousSibling),i.textContent=k((i==null?void 0:i.textContent)||""),D()),l==="Enter"&&(s.preventDefault(),b&&j({type:"line-break"})),o==null||o(s)},re=s=>{K(c.current,V),a==null||a(s)},oe=s=>{D(),t==null||t(s)};function j(s){var N,S;(S=(N=window.getSelection())==null?void 0:N.anchorNode)==null||S.parentElement,c.current;let l=F({tagClassName:P,showTagDeleteBtn:d,valueArr:Array.isArray(s)?s:[s]}),{endNode:i,endOffset:x}=B(c.current),u=i===c.current;if(!c.current||!i||i==null||i===null)return;let[m,T]=J(i.textContent||"",x),E=document.createTextNode(m),w=document.createTextNode(T),C=document.createDocumentFragment(),M=document.createElement("DIV");M.innerHTML=l,C.append(E),Array.from(M.childNodes).map(L=>C.append(L)),C.append(w),C.normalize(),u?c.current.append(C):c.current.replaceChild(C,i),D()}return p.default.createElement(p.default.Fragment,null,p.default.createElement("div",{key:`${Y}-mix-input`,"data-placeholder":y,"aria-label":"input",role:"textbox",tabIndex:0,className:"mix-tag-input",contentEditable:!g,ref:c,onInput:oe,onKeyDown:ne,onSelect:te,onFocus:re,dangerouslySetInnerHTML:{__html:Z},...b?{"aria-multiline":!0}:{},...U}))}),Q=be;var he=Q;
//# sourceMappingURL=index.js.map