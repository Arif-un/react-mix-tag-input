"use client";
"use strict";var Y=Object.create;var H=Object.defineProperty;var tt=Object.getOwnPropertyDescriptor;var et=Object.getOwnPropertyNames;var nt=Object.getPrototypeOf,rt=Object.prototype.hasOwnProperty;var at=(n,i)=>{for(var a in i)H(n,a,{get:i[a],enumerable:!0})},j=(n,i,a,o)=>{if(i&&typeof i=="object"||typeof i=="function")for(let e of et(i))!rt.call(n,e)&&e!==a&&H(n,e,{get:()=>i[e],enumerable:!(o=tt(i,e))||o.enumerable});return n};var ot=(n,i,a)=>(a=n!=null?Y(nt(n)):{},j(i||!n||!n.__esModule?H(a,"default",{value:n,enumerable:!0}):a,n)),st=n=>j(H({},"__esModule",{value:!0}),n);var dt={};at(dt,{default:()=>ut});module.exports=st(dt);var p=ot(require("react"));var $="mtag",N={TAG:"tag",LINE_BREAK:"line-break"};function S(n,i,a=!1){var d,f;if(!n)return[];let o=Array.from(n),e=[];for(let g=0;g<o.length;g+=1){let c=o[g],A=e.at(-1);if(c instanceof Node&&c.nodeName==="#text"&&c.textContent!==`
`&&c.textContent!==""){let y=it(c.textContent||"");typeof A=="string"?e[e.length-1]=A+y:e.push(y||"")}if(c instanceof HTMLElement&&c.nodeName==="SPAN"){let y=(d=c==null?void 0:c.classList)==null?void 0:d.value.replace($,"").trim(),I=((f=c==null?void 0:c.dataset)==null?void 0:f.id)||"";e.push({...a?{tagId:I}:{},type:N.TAG,label:c.innerHTML||c.innerText,...y?{classes:y}:{},...i.current[I]?{data:i.current[I]}:{}})}c instanceof HTMLElement&&c.nodeName==="BR"&&e.push({type:N.LINE_BREAK})}return e}function it(n){return n.replace(/[\u200B]/g,"")}function ct({classes:n,text:i,id:a,showTagDeleteBtn:o}){return`<span data-id="${a}" class="${$} ${n}" contenteditable="false">${i.trim()}${o?'<button class="mtag-delete-btn" contenteditable="false" tabindex="-1">\xD7</button>':""}</span>&ZeroWidthSpace;`}function V({valueArr:n,showTagDeleteBtn:i=!1,tagsDataRef:a,componentId:o}){return!Array.isArray(n)||n.length===0?"":n.reduce((e,d)=>{if(typeof d=="string")return e+=d;if(v(d)){let{label:f,classes:g,data:c}=d,A=q(o);return c&&(a.current[A]=c),e+=ct({classes:g||"",text:f,id:A,showTagDeleteBtn:i})}return typeof d=="object"&&d.type==="line-break"?e+="<br>":""},"")}function q(n){let i=Date.now().toString(36),a=Math.random().toString(36).substr(2);return n+i+a}function F({componentId:n,tagsDataRef:i,showTagDeleteBtn:a,data:o}){let e=document.createElement("span");e.setAttribute("contentEditable","false");let d=q(n);if(e.setAttribute("data-id",d),e.classList.add($),e.innerHTML=o.label,o.classes&&e.classList.add(o.classes),o.data&&(i.current[d]=o.data,e.setAttribute("data-id",d)),a){let f=document.createElement("button");f.classList.add("mtag-delete-btn"),f.setAttribute("contentEditable","false"),f.setAttribute("tabIndex","-1"),f.innerHTML="&times;",e.appendChild(f)}return e}function O(n,i){var d;if(!n)return{foundNode:void 0,nodeIndex:0};let a=null,o=0,e=Array.from(n.childNodes);for(let f=0;f<e.length;f++){let g=e[f];if(g!=null&&g.textContent){let c=g.textContent.length;if(o+c>=i){a=g;break}o+=c}}return a||(a=e.at(-1),o=((d=a==null?void 0:a.textContent)==null?void 0:d.length)||0),{foundNode:a,nodeIndex:o}}function v(n){return typeof n=="object"&&n.type===N.TAG}var lt=(0,p.forwardRef)((n,i)=>{let a=(0,p.useId)(),o=(0,p.useRef)({}),{onChange:e,onClick:d,value:f,multiline:g,placeholder:c,showTagDeleteBtn:A=!0,readonly:y=!1,onPaste:I,onKeyDown:k,onSelect:w,...Z}=n,B=(0,p.useRef)(V({componentId:a,tagsDataRef:o,valueArr:f,showTagDeleteBtn:A})),l=(0,p.useRef)(null),E=(0,p.useRef)(0);(0,p.useEffect)(()=>{l.current&&(l.current.innerHTML=V({componentId:a,tagsDataRef:o,valueArr:f,showTagDeleteBtn:A}))},[f]);let _=t=>{var L,R,x,T;let u=window.getSelection();if(!u)return;let r=u.getRangeAt(0);if(r.commonAncestorContainer!==l.current&&r.commonAncestorContainer.parentElement!==l.current)return;r.deleteContents();let s=null;if(typeof t=="string"?(s=document.createTextNode(t),s.textContent=t):v(t)?s=F({componentId:a,tagsDataRef:o,data:t,showTagDeleteBtn:A}):typeof t=="object"&&t.type===N.LINE_BREAK&&(s=document.createElement("br")),!s){console.error("invalid content");return}r.insertNode(s);let m=document.createRange();m.setStartAfter(s),m.setEndAfter(s),u.removeAllRanges(),u.addRange(m),(L=l.current)==null||L.focus(),B.current=((R=l.current)==null?void 0:R.innerHTML)??"";let b=v(t)?1:0;E.current+=(((x=s==null?void 0:s.textContent)==null?void 0:x.length)||0)+b,e==null||e(S((T=l.current)==null?void 0:T.childNodes,o))};(0,p.useImperativeHandle)(i,()=>({inputRef:l.current,insertContent:_,getValue:()=>{var t;return S((t=l.current)==null?void 0:t.childNodes,o)}}));let U=()=>{var t;l.current&&(B.current=l.current.innerHTML),e==null||e(S((t=l.current)==null?void 0:t.childNodes,o))},z=t=>{var u,r,s,m,b,L,R;if(k==null||k(t),t.key==="Enter"&&!g)t.preventDefault();else if(t.key==="Enter"&&g){t.preventDefault(),_({type:"line-break"});return}else if(t.key==="Backspace"){let{node:x,charCode:T}=K(G()),h=null;if(((u=x==null?void 0:x.previousSibling)==null?void 0:u.nodeName)==="SPAN"){let M=x==null?void 0:x.previousSibling;h=(r=M.getAttribute)==null?void 0:r.call(M,"data-id")}if(h&&T===8203){t.preventDefault();let M=S((s=l.current)==null?void 0:s.childNodes,o,!0),{label:P}=M.find(C=>v(C)&&(C==null?void 0:C.tagId)===h),Q=M.filter(C=>!(v(C)&&C.tagId===h)),X=V({valueArr:Q,componentId:a,showTagDeleteBtn:A,tagsDataRef:o});l!=null&&l.current&&(l.current.innerHTML=X),D(E.current-P.length-1)}E.current-=1;return}else if(t.key==="ArrowLeft"){let{node:x,charCode:T}=K(E.current),h=x==null?void 0:x.previousSibling,M=(m=h.getAttribute)==null?void 0:m.call(h,"data-id");if(M&&T===8203){t.preventDefault();let P=(b=l.current)==null?void 0:b.querySelector(`[data-id="${M}"]`);D(E.current-(((L=P==null?void 0:P.textContent)==null?void 0:L.length)||0)-1)}return}else if(t.key==="ArrowRight"){let x=E.current+1,{node:T}=K(x);(T==null?void 0:T.nodeName)==="SPAN"&&(t.preventDefault(),D(E.current+(((R=T==null?void 0:T.textContent)==null?void 0:R.length)||0)+1));return}else t.key!=="Delete"&&(E.current+=1)},J=t=>{var u,r,s;t.target instanceof HTMLButtonElement&&t.target.classList.contains("mtag-delete-btn")&&((r=(u=t.target)==null?void 0:u.parentElement)==null||r.remove(),e==null||e(S((s=l.current)==null?void 0:s.childNodes,o))),d==null||d(t)};function G(){let t=0;if(window.getSelection){let u=window.getSelection();if(l.current&&(u!=null&&u.rangeCount)&&u.rangeCount>0){let r=u.getRangeAt(0),s=r.cloneRange();s.selectNodeContents(l.current),s.setEnd(r.endContainer,r.endOffset),t=s.toString().length}}return t}(0,p.useEffect)(()=>{D(E.current)},[E.current,f]);function D(t){let u=t;if(!l.current)return;let{foundNode:r,nodeIndex:s}=O(l.current,u);if(r!=null&&r.textContent){let m=document.createRange(),b=window.getSelection();if(!b)return;r!=null&&r.textContent&&(r==null?void 0:r.textContent.length)>=u-s?m.setStart(r,u-s):m.setStart(r,r.textContent.length),m.collapse(!0),b.removeAllRanges(),b.addRange(m)}}function K(t){let u=t,{foundNode:r,nodeIndex:s}=O(l.current,u);if(r!=null&&r.textContent){let m=u-s-1,b=r.textContent[m];return{charCode:b==null?void 0:b.charCodeAt(0),node:r,nodeIndex:s,index:m}}return{}}return p.default.createElement("div",{"data-placeholder":c,"aria-label":"input",role:"textbox",tabIndex:0,className:"mix-tag-input",contentEditable:!y,ref:l,onInput:U,onKeyDown:z,onClick:J,onSelect:t=>{w==null||w(t),E.current=G()},onPaste:t=>{t.preventDefault();let r=t.clipboardData.getData("text/plain");_(r),I==null||I(t)},dangerouslySetInnerHTML:{__html:B.current},...g?{"aria-multiline":!0}:{},...Z})}),W=lt;var ut=W;
//# sourceMappingURL=index.js.map