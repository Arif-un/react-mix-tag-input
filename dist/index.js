"use client";
"use strict";var ee=Object.create;var H=Object.defineProperty;var te=Object.getOwnPropertyDescriptor;var ne=Object.getOwnPropertyNames;var re=Object.getPrototypeOf,ae=Object.prototype.hasOwnProperty;var oe=(t,i)=>{for(var a in i)H(t,a,{get:i[a],enumerable:!0})},G=(t,i,a,o)=>{if(i&&typeof i=="object"||typeof i=="function")for(let n of ne(i))!ae.call(t,n)&&n!==a&&H(t,n,{get:()=>i[n],enumerable:!(o=te(i,n))||o.enumerable});return t};var se=(t,i,a)=>(a=t!=null?ee(re(t)):{},G(i||!t||!t.__esModule?H(a,"default",{value:t,enumerable:!0}):a,t)),ie=t=>G(H({},"__esModule",{value:!0}),t);var fe={};oe(fe,{default:()=>de});module.exports=ie(fe);var p=se(require("react"));var $="mtag",C={TAG:"tag",LINE_BREAK:"line-break"};function L(t,i,a=!1){var d,f;if(!t)return[];let o=Array.from(t),n=[];for(let g=0;g<o.length;g+=1){let c=o[g],A=n.at(-1);if(c instanceof Node&&c.nodeName==="#text"&&c.textContent!==`
`&&c.textContent!==""){let h=ce(c.textContent||"");typeof A=="string"?n[n.length-1]=A+h:n.push(h||"")}if(c instanceof HTMLElement&&c.nodeName==="SPAN"){let h=(d=c==null?void 0:c.classList)==null?void 0:d.value.replace($,"").trim(),I=((f=c==null?void 0:c.dataset)==null?void 0:f.id)||"";n.push({...a?{tagId:I}:{},type:C.TAG,label:c.innerHTML||c.innerText,...h?{classes:h}:{},...i.current[I]?{data:i.current[I]}:{}})}c instanceof HTMLElement&&c.nodeName==="BR"&&n.push({type:C.LINE_BREAK})}return n}function ce(t){return t.replace(/[\u200B]/g,"")}function le({classes:t,text:i,id:a,showTagDeleteBtn:o}){return`<span data-id="${a}" class="${$} ${t}" contenteditable="false">${i.trim()}${o?'<button class="mtag-delete-btn" contenteditable="false" tabindex="-1">\xD7</button>':""}</span>&ZeroWidthSpace;`}function V({valueArr:t,showTagDeleteBtn:i=!1,tagsDataRef:a,componentId:o}){return!Array.isArray(t)||t.length===0?"":t.reduce((n,d)=>{if(typeof d=="string")return n+=d;if(v(d)){let{label:f,classes:g,data:c}=d,A=q(o);return c&&(a.current[A]=c),n+=le({classes:g||"",text:f,id:A,showTagDeleteBtn:i})}return typeof d=="object"&&d.type==="line-break"?n+="<br>":""},"")}function q(t){let i=Date.now().toString(36),a=Math.random().toString(36).substr(2);return t+i+a}function F({componentId:t,tagsDataRef:i,showTagDeleteBtn:a,data:o}){let n=document.createElement("span");n.setAttribute("contentEditable","false");let d=q(t);if(n.setAttribute("data-id",d),n.classList.add($),n.innerHTML=o.label,o.classes&&n.classList.add(o.classes),o.data&&(i.current[d]=o.data,n.setAttribute("data-id",d)),a){let f=document.createElement("button");f.classList.add("mtag-delete-btn"),f.setAttribute("contentEditable","false"),f.setAttribute("tabIndex","-1"),f.innerHTML="&times;",n.appendChild(f)}return n}function O(t,i){var d;if(!t)return{foundNode:void 0,nodeIndex:0};let a=null,o=0,n=Array.from(t.childNodes);for(let f=0;f<n.length;f++){let g=n[f];if(g!=null&&g.textContent){let c=g.textContent.length;if(o+c>=i){a=g;break}o+=c}}return a||(a=n.at(-1),o=((d=a==null?void 0:a.textContent)==null?void 0:d.length)||0),{foundNode:a,nodeIndex:o}}function v(t){return typeof t=="object"&&t.type===C.TAG}function W(t){return typeof t=="object"&&t.type===C.LINE_BREAK}var ue=(0,p.forwardRef)((t,i)=>{let a=(0,p.useId)(),o=(0,p.useRef)({}),{onChange:n,onClick:d,value:f,multiline:g,placeholder:c,showTagDeleteBtn:A=!0,readonly:h=!1,onPaste:I,onKeyDown:k,onSelect:B,...U}=t,w=(0,p.useRef)(V({componentId:a,tagsDataRef:o,valueArr:f,showTagDeleteBtn:A})),l=(0,p.useRef)(null),E=(0,p.useRef)(0);(0,p.useEffect)(()=>{l.current&&(l.current.innerHTML=V({componentId:a,tagsDataRef:o,valueArr:f,showTagDeleteBtn:A}))},[f]);let _=e=>{var R,N,x,T;let u=window.getSelection();if(!u)return;let r=u.getRangeAt(0);if(r.commonAncestorContainer!==l.current&&r.commonAncestorContainer.parentElement!==l.current)return;r.deleteContents();let s=null;if(typeof e=="string"?(s=document.createTextNode(e),s.textContent=e):v(e)?s=F({componentId:a,tagsDataRef:o,data:e,showTagDeleteBtn:A}):typeof e=="object"&&e.type===C.LINE_BREAK&&(s=document.createElement("br")),!s){console.error("invalid content");return}r.insertNode(s);let m=document.createRange();m.setStartAfter(s),m.setEndAfter(s),u.removeAllRanges(),u.addRange(m),(R=l.current)==null||R.focus(),w.current=((N=l.current)==null?void 0:N.innerHTML)??"";let b=v(e)||W(e)?1:0;E.current+=(((x=s==null?void 0:s.textContent)==null?void 0:x.length)||0)+b,n==null||n(L((T=l.current)==null?void 0:T.childNodes,o))};(0,p.useImperativeHandle)(i,()=>({inputRef:l.current,insertContent:_,getValue:()=>{var e;return L((e=l.current)==null?void 0:e.childNodes,o)}}));let z=()=>{var e;l.current&&(w.current=l.current.innerHTML),n==null||n(L((e=l.current)==null?void 0:e.childNodes,o))},J=e=>{var u,r,s,m,b,R,N;if(k==null||k(e),e.key==="Enter"&&!g)e.preventDefault();else if(e.key==="Enter"&&g){e.preventDefault(),_({type:"line-break"});return}else if(e.key==="Backspace"){let{node:x,charCode:T}=K(j()),y=null;if(((u=x==null?void 0:x.previousSibling)==null?void 0:u.nodeName)==="SPAN"){let M=x==null?void 0:x.previousSibling;y=(r=M.getAttribute)==null?void 0:r.call(M,"data-id")}if(y&&T===8203){e.preventDefault();let M=L((s=l.current)==null?void 0:s.childNodes,o,!0),{label:P}=M.find(S=>v(S)&&(S==null?void 0:S.tagId)===y),X=M.filter(S=>!(v(S)&&S.tagId===y)),Y=V({valueArr:X,componentId:a,showTagDeleteBtn:A,tagsDataRef:o});l!=null&&l.current&&(l.current.innerHTML=Y),D(E.current-P.length-1)}E.current-=1;return}else if(e.key==="ArrowLeft"){let{node:x,charCode:T}=K(E.current),y=x==null?void 0:x.previousSibling,M=(m=y.getAttribute)==null?void 0:m.call(y,"data-id");if(M&&T===8203){e.preventDefault();let P=(b=l.current)==null?void 0:b.querySelector(`[data-id="${M}"]`);D(E.current-(((R=P==null?void 0:P.textContent)==null?void 0:R.length)||0)-1)}return}else if(e.key==="ArrowRight"){let x=E.current+1,{node:T}=K(x);(T==null?void 0:T.nodeName)==="SPAN"&&(e.preventDefault(),D(E.current+(((N=T==null?void 0:T.textContent)==null?void 0:N.length)||0)+1));return}else e.key!=="Delete"&&(E.current+=1)},Q=e=>{var u,r,s;e.target instanceof HTMLButtonElement&&e.target.classList.contains("mtag-delete-btn")&&((r=(u=e.target)==null?void 0:u.parentElement)==null||r.remove(),n==null||n(L((s=l.current)==null?void 0:s.childNodes,o))),d==null||d(e)};function j(){let e=0;if(window.getSelection){let u=window.getSelection();if(l.current&&(u!=null&&u.rangeCount)&&u.rangeCount>0){let r=u.getRangeAt(0),s=r.cloneRange();s.selectNodeContents(l.current),s.setEnd(r.endContainer,r.endOffset),e=s.toString().length}}return e}(0,p.useEffect)(()=>{D(E.current)},[E.current,f]);function D(e){let u=e;if(!l.current)return;let{foundNode:r,nodeIndex:s}=O(l.current,u);if(r!=null&&r.textContent){let m=document.createRange(),b=window.getSelection();if(!b)return;r!=null&&r.textContent&&(r==null?void 0:r.textContent.length)>=u-s?m.setStart(r,u-s):m.setStart(r,r.textContent.length),m.collapse(!0),b.removeAllRanges(),b.addRange(m)}}function K(e){let u=e,{foundNode:r,nodeIndex:s}=O(l.current,u);if(r!=null&&r.textContent){let m=u-s-1,b=r.textContent[m];return{charCode:b==null?void 0:b.charCodeAt(0),node:r,nodeIndex:s,index:m}}return{}}return p.default.createElement("div",{"data-placeholder":c,"aria-label":"input",role:"textbox",tabIndex:0,className:"mix-tag-input",contentEditable:!h,ref:l,onInput:z,onKeyDown:J,onClick:Q,onSelect:e=>{B==null||B(e),E.current=j()},onPaste:e=>{e.preventDefault();let r=e.clipboardData.getData("text/plain");_(r),I==null||I(e)},dangerouslySetInnerHTML:{__html:w.current},...g?{"aria-multiline":!0}:{},...U})}),Z=ue;var de=Z;
//# sourceMappingURL=index.js.map