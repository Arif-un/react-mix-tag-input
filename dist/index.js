"use client";
"use strict";var oe=Object.create;var k=Object.defineProperty;var ie=Object.getOwnPropertyDescriptor;var se=Object.getOwnPropertyNames;var ae=Object.getPrototypeOf,de=Object.prototype.hasOwnProperty;var le=(e,n)=>{for(var r in n)k(e,r,{get:n[r],enumerable:!0})},z=(e,n,r,t)=>{if(n&&typeof n=="object"||typeof n=="function")for(let o of se(n))!de.call(e,o)&&o!==r&&k(e,o,{get:()=>n[o],enumerable:!(t=ie(n,o))||t.enumerable});return e};var ue=(e,n,r)=>(r=e!=null?oe(ae(e)):{},z(n||!e||!e.__esModule?k(r,"default",{value:e,enumerable:!0}):r,e)),ce=e=>z(k({},"__esModule",{value:!0}),e);var he={};le(he,{default:()=>xe});module.exports=ce(he);var l=ue(require("react"));var V=1,$=3,_={TAG:"tag",LINE_BREAK:"line-break"};function G(e){return typeof e=="object"&&e.type===_.TAG}function pe(e,n){var u,g,I,m,x,D;let r=Array.from(e.childNodes),t=n<0;if(!e)return{possibleCaretIndex:void 0,node:void 0,nodeIndex:void 0};if(t)return{possibleCaretIndex:0,node:t?r[0]:void 0,nodeIndex:t?r.length:void 0};if(S((u=r[0])==null?void 0:u.textContent)&&n===0)return{node:r.at(0),possibleCaretIndex:1,nodeIndex:0};let a=0,i=0;for(let y=0;y<r.length;y++){let h=r[y];if(h.nodeType!==V&&h.nodeType!==$){console.error("invalid child node");continue}if(a+=((g=h.textContent)==null?void 0:g.length)||0,h.nodeType===$&&a>=n)return{node:h,possibleCaretIndex:n-i,nodeIndex:y};if(h.nodeType===V&&a>=n){let F=S((I=r[y+1])==null?void 0:I.textContent);return{node:r[y+1],possibleCaretIndex:F?1:0,nodeIndex:y+1}}i+=((m=h.textContent)==null?void 0:m.length)||0}return{node:r.at(-1),nodeIndex:r.length-1,possibleCaretIndex:((D=(x=r.at(-1))==null?void 0:x.textContent)==null?void 0:D.length)||0}}function fe(e){let n=Object.keys(e);return n.length?n.reduce((r,t)=>r+=`${t}="${e[t]}" `,""):""}function ge({props:e,tagClassName:n,showTagDeleteBtn:r}){let{label:t,type:o,class:a,...i}=e;return o!=="tag"?"":`<span class="${n||""} ${a||""}" ${fe(i)}contenteditable="false">${t.trim()}${r?'<button class="mtag-delete-btn" contenteditable="false" tabindex="-1">\xD7</button>':""}</span>`}function S(e){return e==null||e===""?!1:e.charCodeAt(0)===8203}function B(e){return e.replace(/[\u200B]/g,"")}function K(e,n,r=!1){var u;if(!e)return;let{node:t,possibleCaretIndex:o}=pe(e,n);console.log("caret set target and possible",{targetCaretPos:n,possibleCaretIndex:o,node:t}),r&&((u=t==null?void 0:t.nextSibling)==null?void 0:u.nodeName)==="BR"&&(t=(t==null?void 0:t.nextSibling.nextSibling)||void 0,o=0);let a=document.createRange(),i=window.getSelection();!i||!t||o===void 0||(a.setStart(t,o),a.collapse(!0),i.removeAllRanges(),i.addRange(a))}function j(e){let n={range:void 0,isCaretInSameNode:void 0,endOffset:void 0,startOffset:void 0,startNode:void 0,endNode:void 0};if(!e||!window.getSelection)return n;let r=window.getSelection();if(e&&(r!=null&&r.rangeCount)&&r.rangeCount>0){let t=r.getRangeAt(0);return{range:t,isCaretInSameNode:t.endContainer===t.startContainer,endOffset:t.endOffset,startOffset:t.startOffset,startNode:t.startContainer,endNode:t.endContainer}}return n}function O(e){let n=document.createElement("DIV");return n.innerHTML=e,n.textContent||n.innerText||""}function X(e){let n=document.createElement("div");return n.innerHTML=e,n.innerHTML}function q(e){let n=0;if(window.getSelection){let r=window.getSelection();if(e&&(r!=null&&r.rangeCount)&&r.rangeCount>0){let t=r.getRangeAt(0),o=t.cloneRange();o.selectNodeContents(e),o.setEnd(t.endContainer,t.endOffset),n=o.toString().length}else return}else return;return n}function Z({tagClassName:e,valueArr:n,showTagDeleteBtn:r=!1}){return Array.isArray(n)?n.length?(console.log("tag value to html"),n.reduce((t,o,a)=>{if(typeof o=="string")return t+=o;if(G(o)){let i=a===0,u=a===n.length-1,g=a>0&&G(n[a-1]);return(i||g)&&(t+="&ZeroWidthSpace;"),t+=ge({props:o,showTagDeleteBtn:r,tagClassName:e}),t+=u?"&ZeroWidthSpace;":"",console.log("==========================",t),t}return typeof o=="object"&&o.type==="line-break"?t+="<br>":""},"")):"":(console.error("[MixTagInput] Wrong value provided"),"")}function J(e,n=""){var o;if(!e)return[];let r=Array.from(e),t=[];for(let a=0;a<r.length;a+=1){let i=r[a],u=t.at(-1);if(i.nodeType===$&&i instanceof Node&&i.textContent!==`
`&&i.textContent!==""&&B(i.textContent||"")!==""){let g=B(i.textContent||"");typeof u=="string"?t[t.length-1]=u+g:t.push(g||"")}if(i.nodeType===V&&i instanceof HTMLElement&&i.nodeName==="SPAN"){let g={};for(let I=0;I<i.attributes.length;I++){let m=i.attributes[I];if(m.nodeName==="class"){let x=(o=m.nodeValue)==null?void 0:o.replaceAll(new RegExp(n,"g"),"").trim();if(x==="")continue;if(x){g[m.nodeName]=x;continue}}m.nodeName!=="contenteditable"&&m.nodeName&&m.nodeValue&&(g[m.nodeName]=m.nodeValue)}t.push({type:_.TAG,label:i.textContent||"",...g})}i instanceof HTMLElement&&i.nodeName==="BR"&&t.push({type:_.LINE_BREAK})}return t}function Q(e,n){return[e.slice(0,n),e.slice(n)]}var me=(0,l.forwardRef)((e,n)=>{let{onChange:r,onInput:t,onKeyDown:o,onSelect:a,onFocus:i,value:u,placeholder:g,showTagDeleteBtn:I=!1,readonly:m=!1,tagClassName:x="mtag",...D}=e,y=(0,l.useId)(),[h,F]=(0,l.useState)(""),c=(0,l.useRef)(null),[H,w]=(0,l.useState)(999);u==null&&console.error("[MixInput] should have value prop but got undefined"),r===void 0&&console.error("[MixInput] should have onChange prop but got undefined"),(0,l.useImperativeHandle)(n,()=>({element:c.current,caretPosition:H,insertContent:re})),(0,l.useLayoutEffect)(()=>{W({triggerOnchange:!1,newHtmlContent:Z({valueArr:u,showTagDeleteBtn:I,tagClassName:x})})},[u,x,I,Z]),(0,l.useLayoutEffect)(()=>{K(c.current,H)},[H]);let W=({newHtmlContent:d,triggerOnchange:C=!0}={})=>{var N;let s=c.current;if(!s)return;let M=d!==void 0,p=M?X(d):s.innerHTML,T=M?O(p):O(s.textContent||""),A=M&&S(h.charAt(1)),b=O(T).length-O(h).length;{let E=S(T.charAt(T.length-1)),P=H===T.length-1;E&&P&&(b+=1)}A&&(b=1);let L=p.endsWith("</span>"),f=p;L&&(f+="&ZeroWidthSpace;"),f.length-b<0&&(b=0),w(E=>f.length+b<0?0:E+b),F(f),C&&(r==null||r(J((N=c.current)==null?void 0:N.childNodes,x)))},Y=d=>{a==null||a(d);let C=q(c.current);typeof C=="number"&&w(C)},ee=d=>{var b,L,f,N;let C=d.key,{endNode:s,endOffset:M}=j(c.current),p=s==null?void 0:s.previousSibling,T=s==null?void 0:s.nextSibling,A=1;if(C==="ArrowLeft"&&s&&p&&S((b=s.textContent)==null?void 0:b.at(M-1))){d.preventDefault();let E=p.nodeName==="BR",P=p.nodeName==="SPAN";E&&w(v=>v-1),P&&w(v=>{var R;return v-((((R=p==null?void 0:p.textContent)==null?void 0:R.length)||0)+A)})}if(C==="ArrowRight"&&s&&T&&S((L=s.textContent)==null?void 0:L.at(M))){d.preventDefault();let E=T.nodeName==="BR",P=T.nodeName==="SPAN";E&&w(v=>v+1),P&&w(v=>{var R;return v+(((R=p==null?void 0:p.textContent)==null?void 0:R.length)||0)+A})}C==="Backspace"&&s&&S((f=s.textContent)==null?void 0:f.at(M-1))&&((N=s.previousSibling)==null?void 0:N.nodeType)===V&&c.current&&(d.preventDefault(),c.current.removeChild(s.previousSibling),s.textContent=B((s==null?void 0:s.textContent)||""),W()),C==="Enter"&&d.preventDefault(),o==null||o(d)},te=d=>{K(c.current,H),i==null||i(d)},ne=d=>{W(),t==null||t(d)};function re(d){let C=Z({tagClassName:x,showTagDeleteBtn:I,valueArr:Array.isArray(d)?d:[d]}),{endNode:s,endOffset:M}=j(c.current),p=s===c.current;if(!c.current||!s||s==null||s===null)return;let[T,A]=Q(s.textContent||"",M),b=document.createTextNode(T),L=document.createTextNode(A),f=document.createDocumentFragment(),N=document.createElement("DIV");N.innerHTML=C,f.append(b),Array.from(N.childNodes).map(E=>f.append(E)),f.append(L),f.normalize(),p?c.current.append(f):c.current.replaceChild(f,s),W()}return l.default.createElement(l.default.Fragment,null,l.default.createElement("div",{key:`${y}-mix-input`,"data-placeholder":g,"aria-label":"input",role:"textbox",tabIndex:0,className:"mix-tag-input",contentEditable:!m,ref:c,onInput:ne,onKeyDown:ee,onSelect:Y,onFocus:te,dangerouslySetInnerHTML:{__html:h},...D}))}),U=me;var xe=U;
//# sourceMappingURL=index.js.map