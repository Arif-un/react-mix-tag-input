"use client";
"use strict";var re=Object.create;var V=Object.defineProperty;var ae=Object.getOwnPropertyDescriptor;var oe=Object.getOwnPropertyNames;var se=Object.getPrototypeOf,ie=Object.prototype.hasOwnProperty;var ue=(e,o)=>{for(var a in o)V(e,a,{get:o[a],enumerable:!0})},q=(e,o,a,s)=>{if(o&&typeof o=="object"||typeof o=="function")for(let t of oe(o))!ie.call(e,t)&&t!==a&&V(e,t,{get:()=>o[t],enumerable:!(s=ae(o,t))||s.enumerable});return e};var le=(e,o,a)=>(a=e!=null?re(se(e)):{},q(o||!e||!e.__esModule?V(a,"default",{value:e,enumerable:!0}):a,e)),ce=e=>q(V({},"__esModule",{value:!0}),e);var xe={};ue(xe,{default:()=>ge});module.exports=ce(xe);var g=le(require("react"));var O="mtag",H={TAG:"tag",LINE_BREAK:"line-break"};function N(e,o,a=!1){var c,f;if(!e)return[];let s=Array.from(e),t=[];for(let x=0;x<s.length;x+=1){let i=s[x],E=t.at(-1);if(i instanceof Node&&i.nodeName==="#text"&&i.textContent!==`
`&&i.textContent!==""){let C=de(i.textContent||"");typeof E=="string"?t[t.length-1]=E+C:t.push(C||"")}if(i instanceof HTMLElement&&i.nodeName==="SPAN"){let C=(c=i==null?void 0:i.classList)==null?void 0:c.value.replace(O,"").trim(),h=((f=i==null?void 0:i.dataset)==null?void 0:f.id)||"";t.push({...a?{tagId:h}:{},type:H.TAG,label:i.innerHTML||i.innerText,...C?{classes:C}:{},...o.current[h]?{data:o.current[h]}:{}})}i instanceof HTMLElement&&i.nodeName==="BR"&&t.push({type:H.LINE_BREAK})}return t}function de(e){return e.replace(/[\u200B]/g,"")}function fe({classes:e,text:o,id:a,showTagDeleteBtn:s}){return`<span data-id="${a}" class="${O} ${e}" contenteditable="false">${o.trim()}${s?'<button class="mtag-delete-btn" contenteditable="false" tabindex="-1">\xD7</button>':""}</span>&ZeroWidthSpace;`}function D({valueArr:e,showTagDeleteBtn:o=!1,tagsDataRef:a,componentId:s}){return!Array.isArray(e)||e.length===0?"":e.reduce((t,c)=>{if(typeof c=="string")return t+=c;if(I(c)){let{label:f,classes:x,data:i}=c,E=Z(s);return i&&(a.current[E]=i),t+=fe({classes:x||"",text:f,id:E,showTagDeleteBtn:o})}return typeof c=="object"&&c.type==="line-break"?t+="<br>":""},"")}function Z(e){let o=Date.now().toString(36),a=Math.random().toString(36).substr(2);return e+o+a}function W({componentId:e,tagsDataRef:o,showTagDeleteBtn:a,data:s}){let t=document.createElement("span");t.setAttribute("contentEditable","false");let c=Z(e);if(t.setAttribute("data-id",c),t.classList.add(O),t.innerHTML=s.label,s.classes&&t.classList.add(s.classes),s.data&&(o.current[c]=s.data,t.setAttribute("data-id",c)),a){let f=document.createElement("button");f.classList.add("mtag-delete-btn"),f.setAttribute("contentEditable","false"),f.setAttribute("tabIndex","-1"),f.innerHTML="&times;",t.appendChild(f)}return t}function G(e,o){var c;if(!e)return{foundNode:void 0,nodeIndex:0};let a=null,s=0,t=Array.from(e.childNodes);for(let f=0;f<t.length;f++){let x=t[f];if(x!=null&&x.textContent){let i=x.textContent.length;if(s+i>=o){a=x;break}s+=i}}return a||(a=t.at(-1),s=((c=a==null?void 0:a.textContent)==null?void 0:c.length)||0),{foundNode:a,nodeIndex:s}}function I(e){return typeof e=="object"&&e.type===H.TAG}function $(e){return typeof e=="object"&&e.type===H.LINE_BREAK}function U({item:e,componentId:o,tagsDataRef:a,showTagDeleteBtn:s}){if(typeof e=="string"){let t=document.createTextNode(e);return t.textContent=e,t}else{if(I(e))return W({componentId:o,tagsDataRef:a,data:e,showTagDeleteBtn:s});if($(e))return document.createElement("br");if(Array.isArray(e))return e.map(t=>{if(typeof t=="string"){let c=document.createTextNode(t);return c.textContent=t,c}else if(I(t))return W({componentId:o,tagsDataRef:a,data:t,showTagDeleteBtn:s})}).reverse()}}function z(e){if(Array.isArray(e)){let o=e.at(-1);if(o&&($(o)||I(o)))return 1}else if($(e)||I(e))return 1;return 0}var pe=(0,g.forwardRef)((e,o)=>{let a=(0,g.useId)(),s=(0,g.useRef)({}),{onChange:t,onClick:c,value:f,multiline:x,placeholder:i,showTagDeleteBtn:E=!0,readonly:C=!1,onPaste:h,onKeyDown:w,onSelect:k,onFocus:B,...Q}=e,F=(0,g.useRef)(D({componentId:a,tagsDataRef:s,valueArr:f,showTagDeleteBtn:E})),u=(0,g.useRef)(null),y=(0,g.useRef)(0);(0,g.useEffect)(()=>{u.current&&(u.current.innerHTML=D({componentId:a,tagsDataRef:s,valueArr:f,showTagDeleteBtn:E}))},[f]);let _=n=>{var L,P,m,M;let d=window.getSelection();if(!d)return;let r=d.getRangeAt(0);if(r.commonAncestorContainer!==u.current&&r.commonAncestorContainer.parentElement!==u.current)return;r.deleteContents();let l=U({item:n,componentId:a,tagsDataRef:s,showTagDeleteBtn:E}),p=0;if(Array.isArray(l)?l.forEach(T=>{var b;T&&(T.nodeName!=="BR"&&(p+=((b=T.textContent)==null?void 0:b.length)||0),T.nodeName==="SPAN"&&(p+=1),r.insertNode(T),r.setEndAfter(T))}):l&&(l.nodeName!=="BR"&&(p+=((L=l.textContent)==null?void 0:L.length)||0),l.nodeName==="SPAN"&&(p+=1),r.insertNode(l),r.setEndAfter(l)),!l){console.error("invalid content");return}F.current=((P=u.current)==null?void 0:P.innerHTML)??"";let A=z(n);y.current+=p+A,(m=u.current)==null||m.focus(),t==null||t(N((M=u.current)==null?void 0:M.childNodes,s))};(0,g.useImperativeHandle)(o,()=>({inputRef:u.current,insertContent:_,getValue:()=>{var n;return N((n=u.current)==null?void 0:n.childNodes,s)}}));let X=()=>{var n;u.current&&(F.current=u.current.innerHTML),t==null||t(N((n=u.current)==null?void 0:n.childNodes,s))},Y=n=>{var d,r,l,p,A,L,P;if(w==null||w(n),n.key==="Enter"&&!x)n.preventDefault();else if(n.key==="Enter"&&x){n.preventDefault(),_({type:"line-break"});return}else if(n.key==="Backspace"){let{node:m,charCode:M}=K(j()),T=null;if(((d=m==null?void 0:m.previousSibling)==null?void 0:d.nodeName)==="SPAN"){let b=m==null?void 0:m.previousSibling;T=(r=b.getAttribute)==null?void 0:r.call(b,"data-id")}if(T&&M===8203){n.preventDefault();let b=N((l=u.current)==null?void 0:l.childNodes,s,!0),{label:R}=b.find(v=>I(v)&&(v==null?void 0:v.tagId)===T),te=b.filter(v=>!(I(v)&&v.tagId===T)),ne=D({valueArr:te,componentId:a,showTagDeleteBtn:E,tagsDataRef:s});u!=null&&u.current&&(u.current.innerHTML=ne),S(y.current-R.length-1)}y.current-=1;return}else if(n.key==="ArrowLeft"){let{node:m,charCode:M}=K(y.current),T=m==null?void 0:m.previousSibling,b=(p=T.getAttribute)==null?void 0:p.call(T,"data-id");if(b&&M===8203){n.preventDefault();let R=(A=u.current)==null?void 0:A.querySelector(`[data-id="${b}"]`);S(y.current-(((L=R==null?void 0:R.textContent)==null?void 0:L.length)||0)-1)}return}else if(n.key==="ArrowRight"){let m=y.current+1,{node:M}=K(m);(M==null?void 0:M.nodeName)==="SPAN"&&(n.preventDefault(),S(y.current+(((P=M==null?void 0:M.textContent)==null?void 0:P.length)||0)+1));return}else n.key!=="Delete"&&n.key!=="Tab"&&(y.current+=1)},ee=n=>{var d,r,l;n.target instanceof HTMLButtonElement&&n.target.classList.contains("mtag-delete-btn")&&((r=(d=n.target)==null?void 0:d.parentElement)==null||r.remove(),t==null||t(N((l=u.current)==null?void 0:l.childNodes,s))),c==null||c(n)};function j(){let n=0;if(window.getSelection){let d=window.getSelection();if(u.current&&(d!=null&&d.rangeCount)&&d.rangeCount>0){let r=d.getRangeAt(0),l=r.cloneRange();l.selectNodeContents(u.current),l.setEnd(r.endContainer,r.endOffset),n=l.toString().length}}return n}(0,g.useEffect)(()=>{S(y.current)},[y.current,f]);function S(n){let d=n;if(!u.current)return;let{foundNode:r,nodeIndex:l}=G(u.current,d);if(r!=null&&r.textContent){let p=document.createRange(),A=window.getSelection();if(!A)return;r!=null&&r.textContent&&(r==null?void 0:r.textContent.length)>=d-l?p.setStart(r,d-l):p.setStart(r,r.textContent.length),p.collapse(!0),A.removeAllRanges(),A.addRange(p),y.current=n}}function K(n){let d=n,{foundNode:r,nodeIndex:l}=G(u.current,d);if(r!=null&&r.textContent){let p=d-l-1,A=r.textContent[p];return{charCode:A==null?void 0:A.charCodeAt(0),node:r,nodeIndex:l,index:p}}return{}}return g.default.createElement("div",{"data-placeholder":i,"aria-label":"input",role:"textbox",tabIndex:0,className:"mix-tag-input",contentEditable:!C,ref:u,onInput:X,onKeyDown:Y,onClick:ee,onSelect:n=>{k==null||k(n),y.current=j()},onPaste:n=>{n.preventDefault();let r=n.clipboardData.getData("text/plain");_(r),h==null||h(n)},onFocus:n=>{S(y.current),B==null||B(n)},dangerouslySetInnerHTML:{__html:F.current},...x?{"aria-multiline":!0}:{},...Q})}),J=pe;var ge=J;
//# sourceMappingURL=index.js.map