"use client";
"use strict";var te=Object.create;var P=Object.defineProperty;var ne=Object.getOwnPropertyDescriptor;var re=Object.getOwnPropertyNames;var ae=Object.getPrototypeOf,oe=Object.prototype.hasOwnProperty;var se=(e,s)=>{for(var a in s)P(e,a,{get:s[a],enumerable:!0})},j=(e,s,a,o)=>{if(s&&typeof s=="object"||typeof s=="function")for(let t of re(s))!oe.call(e,t)&&t!==a&&P(e,t,{get:()=>s[t],enumerable:!(o=ne(s,t))||o.enumerable});return e};var ie=(e,s,a)=>(a=e!=null?te(ae(e)):{},j(s||!e||!e.__esModule?P(a,"default",{value:e,enumerable:!0}):a,e)),ue=e=>j(P({},"__esModule",{value:!0}),e);var ge={};se(ge,{default:()=>pe});module.exports=ue(ge);var x=ie(require("react"));var $="mtag",V={TAG:"tag",LINE_BREAK:"line-break"};function N(e,s,a=!1){var l,f;if(!e)return[];let o=Array.from(e),t=[];for(let T=0;T<o.length;T+=1){let i=o[T],A=t.at(-1);if(i instanceof Node&&i.nodeName==="#text"&&i.textContent!==`
`&&i.textContent!==""){let h=ce(i.textContent||"");typeof A=="string"?t[t.length-1]=A+h:t.push(h||"")}if(i instanceof HTMLElement&&i.nodeName==="SPAN"){let h=(l=i==null?void 0:i.classList)==null?void 0:l.value.replace($,"").trim(),C=((f=i==null?void 0:i.dataset)==null?void 0:f.id)||"";t.push({...a?{tagId:C}:{},type:V.TAG,label:i.innerHTML||i.innerText,...h?{classes:h}:{},...s.current[C]?{data:s.current[C]}:{}})}i instanceof HTMLElement&&i.nodeName==="BR"&&t.push({type:V.LINE_BREAK})}return t}function ce(e){return e.replace(/[\u200B]/g,"")}function le({classes:e,text:s,id:a,showTagDeleteBtn:o}){return`<span data-id="${a}" class="${$} ${e}" contenteditable="false">${s.trim()}${o?'<button class="mtag-delete-btn" contenteditable="false" tabindex="-1">\xD7</button>':""}</span>&ZeroWidthSpace;`}function D({valueArr:e,showTagDeleteBtn:s=!1,tagsDataRef:a,componentId:o}){return!Array.isArray(e)||e.length===0?"":e.reduce((t,l)=>{if(typeof l=="string")return t+=l;if(v(l)){let{label:f,classes:T,data:i}=l,A=W(o);return i&&(a.current[A]=i),t+=le({classes:T||"",text:f,id:A,showTagDeleteBtn:s})}return typeof l=="object"&&l.type==="line-break"?t+="<br>":""},"")}function W(e){let s=Date.now().toString(36),a=Math.random().toString(36).substr(2);return e+s+a}function q({componentId:e,tagsDataRef:s,showTagDeleteBtn:a,data:o}){let t=document.createElement("span");t.setAttribute("contentEditable","false");let l=W(e);if(t.setAttribute("data-id",l),t.classList.add($),t.innerHTML=o.label,o.classes&&t.classList.add(o.classes),o.data&&(s.current[l]=o.data,t.setAttribute("data-id",l)),a){let f=document.createElement("button");f.classList.add("mtag-delete-btn"),f.setAttribute("contentEditable","false"),f.setAttribute("tabIndex","-1"),f.innerHTML="&times;",t.appendChild(f)}return t}function O(e,s){var l;if(!e)return{foundNode:void 0,nodeIndex:0};let a=null,o=0,t=Array.from(e.childNodes);for(let f=0;f<t.length;f++){let T=t[f];if(T!=null&&T.textContent){let i=T.textContent.length;if(o+i>=s){a=T;break}o+=i}}return a||(a=t.at(-1),o=((l=a==null?void 0:a.textContent)==null?void 0:l.length)||0),{foundNode:a,nodeIndex:o}}function v(e){return typeof e=="object"&&e.type===V.TAG}function de(e){return typeof e=="object"&&e.type===V.LINE_BREAK}function Z({item:e,componentId:s,tagsDataRef:a,showTagDeleteBtn:o}){if(typeof e=="string"){let t=document.createTextNode(e);return t.textContent=e,t}else{if(v(e))return q({componentId:s,tagsDataRef:a,data:e,showTagDeleteBtn:o});if(de(e))return document.createElement("br");if(Array.isArray(e))return e.map(t=>{if(typeof t=="string"){let l=document.createTextNode(t);return l.textContent=t,l}else if(v(t))return q({componentId:s,tagsDataRef:a,data:t,showTagDeleteBtn:o})}).reverse()}}var fe=(0,x.forwardRef)((e,s)=>{let a=(0,x.useId)(),o=(0,x.useRef)({}),{onChange:t,onClick:l,value:f,multiline:T,placeholder:i,showTagDeleteBtn:A=!0,readonly:h=!1,onPaste:C,onKeyDown:w,onSelect:k,onFocus:B,...z}=e,F=(0,x.useRef)(D({componentId:a,tagsDataRef:o,valueArr:f,showTagDeleteBtn:A})),u=(0,x.useRef)(null),y=(0,x.useRef)(0);(0,x.useEffect)(()=>{u.current&&(u.current.innerHTML=D({componentId:a,tagsDataRef:o,valueArr:f,showTagDeleteBtn:A}))},[f]);let _=n=>{var M,L,R,m;let d=window.getSelection();if(!d)return;let r=d.getRangeAt(0);if(r.commonAncestorContainer!==u.current&&r.commonAncestorContainer.parentElement!==u.current)return;r.deleteContents();let c=Z({item:n,componentId:a,tagsDataRef:o,showTagDeleteBtn:A}),g=0;if(Array.isArray(c)?c.forEach(p=>{var b;p&&(p.nodeName!=="BR"&&(g+=((b=p.textContent)==null?void 0:b.length)||0),p.nodeName==="SPAN"&&(g+=1),r.insertNode(p),r.setEndAfter(p))}):c&&(c.nodeName!=="BR"&&(g+=((M=c.textContent)==null?void 0:M.length)||0),c.nodeName==="SPAN"&&(g+=1),r.insertNode(c),r.setEndAfter(c)),!c){console.error("invalid content");return}F.current=((L=u.current)==null?void 0:L.innerHTML)??"",y.current+=g,(R=u.current)==null||R.focus(),t==null||t(N((m=u.current)==null?void 0:m.childNodes,o))};(0,x.useImperativeHandle)(s,()=>({inputRef:u.current,insertContent:_,getValue:()=>{var n;return N((n=u.current)==null?void 0:n.childNodes,o)}}));let J=()=>{var n;u.current&&(F.current=u.current.innerHTML),t==null||t(N((n=u.current)==null?void 0:n.childNodes,o))},Q=n=>{var d,r,c,g,M,L,R;if(w==null||w(n),n.key==="Enter"&&!T)n.preventDefault();else if(n.key==="Enter"&&T){n.preventDefault(),_({type:"line-break"});return}else if(n.key==="Backspace"){let{node:m,charCode:p}=K(G()),b=null;if(((d=m==null?void 0:m.previousSibling)==null?void 0:d.nodeName)==="SPAN"){let E=m==null?void 0:m.previousSibling;b=(r=E.getAttribute)==null?void 0:r.call(E,"data-id")}if(b&&p===8203){n.preventDefault();let E=N((c=u.current)==null?void 0:c.childNodes,o,!0),{label:H}=E.find(I=>v(I)&&(I==null?void 0:I.tagId)===b),Y=E.filter(I=>!(v(I)&&I.tagId===b)),ee=D({valueArr:Y,componentId:a,showTagDeleteBtn:A,tagsDataRef:o});u!=null&&u.current&&(u.current.innerHTML=ee),S(y.current-H.length-1)}y.current-=1;return}else if(n.key==="ArrowLeft"){let{node:m,charCode:p}=K(y.current),b=m==null?void 0:m.previousSibling,E=(g=b.getAttribute)==null?void 0:g.call(b,"data-id");if(E&&p===8203){n.preventDefault();let H=(M=u.current)==null?void 0:M.querySelector(`[data-id="${E}"]`);S(y.current-(((L=H==null?void 0:H.textContent)==null?void 0:L.length)||0)-1)}return}else if(n.key==="ArrowRight"){let m=y.current+1,{node:p}=K(m);(p==null?void 0:p.nodeName)==="SPAN"&&(n.preventDefault(),S(y.current+(((R=p==null?void 0:p.textContent)==null?void 0:R.length)||0)+1));return}else n.key!=="Delete"&&n.key!=="Tab"&&(y.current+=1)},X=n=>{var d,r,c;n.target instanceof HTMLButtonElement&&n.target.classList.contains("mtag-delete-btn")&&((r=(d=n.target)==null?void 0:d.parentElement)==null||r.remove(),t==null||t(N((c=u.current)==null?void 0:c.childNodes,o))),l==null||l(n)};function G(){let n=0;if(window.getSelection){let d=window.getSelection();if(u.current&&(d!=null&&d.rangeCount)&&d.rangeCount>0){let r=d.getRangeAt(0),c=r.cloneRange();c.selectNodeContents(u.current),c.setEnd(r.endContainer,r.endOffset),n=c.toString().length}}return n}(0,x.useEffect)(()=>{S(y.current)},[y.current,f]);function S(n){let d=n;if(!u.current)return;let{foundNode:r,nodeIndex:c}=O(u.current,d);if(r!=null&&r.textContent){let g=document.createRange(),M=window.getSelection();if(!M)return;r!=null&&r.textContent&&(r==null?void 0:r.textContent.length)>=d-c?g.setStart(r,d-c):g.setStart(r,r.textContent.length),g.collapse(!0),M.removeAllRanges(),M.addRange(g),y.current=n}}function K(n){let d=n,{foundNode:r,nodeIndex:c}=O(u.current,d);if(r!=null&&r.textContent){let g=d-c-1,M=r.textContent[g];return{charCode:M==null?void 0:M.charCodeAt(0),node:r,nodeIndex:c,index:g}}return{}}return x.default.createElement("div",{"data-placeholder":i,"aria-label":"input",role:"textbox",tabIndex:0,className:"mix-tag-input",contentEditable:!h,ref:u,onInput:J,onKeyDown:Q,onClick:X,onSelect:n=>{k==null||k(n),y.current=G()},onPaste:n=>{n.preventDefault();let r=n.clipboardData.getData("text/plain");_(r),C==null||C(n)},onFocus:n=>{S(y.current),B==null||B(n)},dangerouslySetInnerHTML:{__html:F.current},...T?{"aria-multiline":!0}:{},...z})}),U=fe;var pe=U;
//# sourceMappingURL=index.js.map