"use client";
"use strict";var Y=Object.create;var H=Object.defineProperty;var tt=Object.getOwnPropertyDescriptor;var et=Object.getOwnPropertyNames;var nt=Object.getPrototypeOf,rt=Object.prototype.hasOwnProperty;var at=(n,i)=>{for(var a in i)H(n,a,{get:i[a],enumerable:!0})},j=(n,i,a,o)=>{if(i&&typeof i=="object"||typeof i=="function")for(let e of et(i))!rt.call(n,e)&&e!==a&&H(n,e,{get:()=>i[e],enumerable:!(o=tt(i,e))||o.enumerable});return n};var ot=(n,i,a)=>(a=n!=null?Y(nt(n)):{},j(i||!n||!n.__esModule?H(a,"default",{value:n,enumerable:!0}):a,n)),st=n=>j(H({},"__esModule",{value:!0}),n);var dt={};at(dt,{default:()=>ut});module.exports=st(dt);var g=ot(require("react"));var $="mtag",N={TAG:"tag",LINE_BREAK:"line-break"};function C(n,i,a=!1){var d,f;if(!n)return[];let o=Array.from(n),e=[];for(let p=0;p<o.length;p+=1){let c=o[p],M=e.at(-1);if(c instanceof Node&&c.nodeName==="#text"&&c.textContent!==`
`&&c.textContent!==""){let E=it(c.textContent||"");typeof M=="string"?e[e.length-1]=M+E:e.push(E||"")}if(c instanceof HTMLElement&&c.nodeName==="SPAN"){let E=(d=c==null?void 0:c.classList)==null?void 0:d.value.replace($,"").trim(),I=((f=c==null?void 0:c.dataset)==null?void 0:f.id)||"";e.push({...a?{tagId:I}:{},type:N.TAG,label:c.innerHTML||c.innerText,...E?{classes:E}:{},...i.current[I]?{data:i.current[I]}:{}})}c instanceof HTMLElement&&c.nodeName==="BR"&&e.push({type:N.LINE_BREAK})}return e}function it(n){return n.replace(/[\u200B]/g,"")}function ct({classes:n,text:i,id:a,showTagDeleteBtn:o}){return`<span data-id="${a}" class="${$} ${n}" contenteditable="false">${i.trim()}${o?'<button class="mtag-delete-btn" contenteditable="false" tabindex="-1">\xD7</button>':""}</span>&ZeroWidthSpace;`}function V({valueArr:n,showTagDeleteBtn:i=!1,tagsDataRef:a,componentId:o}){return!Array.isArray(n)||n.length===0?"":n.reduce((e,d)=>{if(typeof d=="string")return e+=d;if(v(d)){let{label:f,classes:p,data:c}=d,M=q(o);return c&&(a.current[M]=c),e+=ct({classes:p||"",text:f,id:M,showTagDeleteBtn:i})}return typeof d=="object"&&d.type==="line-break"?e+="<br>":""},"")}function q(n){let i=Date.now().toString(36),a=Math.random().toString(36).substr(2);return n+i+a}function F({componentId:n,tagsDataRef:i,showTagDeleteBtn:a,data:o}){let e=document.createElement("span");e.setAttribute("contentEditable","false");let d=q(n);if(e.setAttribute("data-id",d),e.classList.add($),e.innerHTML=o.label,o.classes&&e.classList.add(o.classes),o.data&&(i.current[d]=o.data,e.setAttribute("data-id",d)),a){let f=document.createElement("button");f.classList.add("mtag-delete-btn"),f.setAttribute("contentEditable","false"),f.setAttribute("tabIndex","-1"),f.innerHTML="&times;",e.appendChild(f)}return e}function O(n,i){var d;if(!n)return{foundNode:void 0,nodeIndex:0};let a=null,o=0,e=Array.from(n.childNodes);for(let f=0;f<e.length;f++){let p=e[f];if(p!=null&&p.textContent){let c=p.textContent.length;if(o+c>=i){a=p;break}o+=c}}return a||(a=e.at(-1),o=((d=a==null?void 0:a.textContent)==null?void 0:d.length)||0),{foundNode:a,nodeIndex:o}}function v(n){return typeof n=="object"&&n.type===N.TAG}var lt=(0,g.forwardRef)((n,i)=>{let a=(0,g.useId)(),o=(0,g.useRef)({}),{onChange:e,onClick:d,value:f,multiline:p,placeholder:c,showTagDeleteBtn:M=!0,readonly:E=!1,onPaste:I,onKeyDown:k,onSelect:w,...Z}=n,B=(0,g.useRef)(V({componentId:a,tagsDataRef:o,valueArr:f,showTagDeleteBtn:M})),l=(0,g.useRef)(null),b=(0,g.useRef)(0);(0,g.useEffect)(()=>{l.current&&(l.current.innerHTML=V({componentId:a,tagsDataRef:o,valueArr:f,showTagDeleteBtn:M}))},[f]);let _=t=>{var L,R,x,T;let u=window.getSelection();if(!u)return;let r=u.getRangeAt(0);if(r.commonAncestorContainer!==l.current&&r.commonAncestorContainer.parentElement!==l.current)return;r.deleteContents();let s=null;if(typeof t=="string"?(s=document.createTextNode(t),s.textContent=t):v(t)?s=F({componentId:a,tagsDataRef:o,data:t,showTagDeleteBtn:M}):typeof t=="object"&&t.type===N.LINE_BREAK&&(s=document.createElement("br")),!s){console.error("invalid content");return}r.insertNode(s);let m=document.createRange();m.setStartAfter(s),m.setEndAfter(s),u.removeAllRanges(),u.addRange(m),(L=l.current)==null||L.focus(),B.current=((R=l.current)==null?void 0:R.innerHTML)??"";let A=v(t)?1:0;b.current+=(((x=s==null?void 0:s.textContent)==null?void 0:x.length)||0)+A,e==null||e(C((T=l.current)==null?void 0:T.childNodes,o))};(0,g.useImperativeHandle)(i,()=>({inputRef:l.current,insertContent:_,getValue:()=>{var t;return C((t=l.current)==null?void 0:t.childNodes,o)}}));let U=()=>{var t;l.current&&(B.current=l.current.innerHTML),e==null||e(C((t=l.current)==null?void 0:t.childNodes,o))},z=t=>{var u,r,s,m,A,L,R;if(k==null||k(t),t.key==="Enter"&&!p)t.preventDefault();else if(t.key==="Enter"&&p){t.preventDefault(),_({type:"line-break"});return}else if(t.key==="Backspace"){let{node:x,charCode:T}=K(G()),y=null;if(((u=x==null?void 0:x.previousSibling)==null?void 0:u.nodeName)==="SPAN"){let h=x==null?void 0:x.previousSibling;y=(r=h.getAttribute)==null?void 0:r.call(h,"data-id")}if(y&&T===8203){t.preventDefault();let h=C((s=l.current)==null?void 0:s.childNodes,o,!0),{label:P}=h.find(S=>v(S)&&(S==null?void 0:S.tagId)===y),Q=h.filter(S=>!(v(S)&&S.tagId===y)),X=V({valueArr:Q,componentId:a,showTagDeleteBtn:M,tagsDataRef:o});l!=null&&l.current&&(l.current.innerHTML=X),D(b.current-P.length-1)}b.current-=1;return}else if(t.key==="ArrowLeft"){let{node:x,charCode:T}=K(b.current),y=x==null?void 0:x.previousSibling,h=(m=y.getAttribute)==null?void 0:m.call(y,"data-id");if(h&&T===8203){t.preventDefault();let P=(A=l.current)==null?void 0:A.querySelector(`[data-id="${h}"]`);D(b.current-(((L=P==null?void 0:P.textContent)==null?void 0:L.length)||0)-1)}return}else if(t.key==="ArrowRight"){let x=b.current+1,{node:T}=K(x);(T==null?void 0:T.nodeName)==="SPAN"&&(t.preventDefault(),D(b.current+(((R=T==null?void 0:T.textContent)==null?void 0:R.length)||0)+1));return}else t.key!=="Delete"&&(b.current+=1)},J=t=>{var u,r,s;t.target instanceof HTMLButtonElement&&t.target.classList.contains("mtag-delete-btn")&&((r=(u=t.target)==null?void 0:u.parentElement)==null||r.remove(),e==null||e(C((s=l.current)==null?void 0:s.childNodes,o))),d==null||d(t)};function G(){let t=0;if(window.getSelection){let u=window.getSelection();if(l.current&&(u!=null&&u.rangeCount)&&u.rangeCount>0){let r=u.getRangeAt(0),s=r.cloneRange();s.selectNodeContents(l.current),s.setEnd(r.endContainer,r.endOffset),t=s.toString().length}}return t}(0,g.useEffect)(()=>{D(b.current)},[b.current,f]);function D(t){let u=t;if(!l.current)return;let{foundNode:r,nodeIndex:s}=O(l.current,u);if(r!=null&&r.textContent){let m=document.createRange(),A=window.getSelection();if(!A)return;r!=null&&r.textContent&&(r==null?void 0:r.textContent.length)>=u-s?m.setStart(r,u-s):m.setStart(r,r.textContent.length),m.collapse(!0),A.removeAllRanges(),A.addRange(m)}}function K(t){let u=t,{foundNode:r,nodeIndex:s}=O(l.current,u);if(r!=null&&r.textContent){let m=u-s-1,A=r.textContent[m];return{charCode:A==null?void 0:A.charCodeAt(0),node:r,nodeIndex:s,index:m}}return{}}return g.default.createElement("div",{"data-placeholder":c,"aria-label":"input",role:"textbox",tabIndex:0,className:"mix-tag-input",contentEditable:!E,ref:l,onInput:U,onKeyDown:z,onClick:J,onSelect:t=>{w==null||w(t),b.current=G(),console.log("cursor pos",b.current)},onPaste:t=>{t.preventDefault();let r=t.clipboardData.getData("text/plain");_(r),I==null||I(t)},dangerouslySetInnerHTML:{__html:B.current},...p?{"aria-multiline":!0}:{},...Z})}),W=lt;var ut=W;
//# sourceMappingURL=index.js.map