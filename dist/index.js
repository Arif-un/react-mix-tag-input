"use client";
"use strict";var te=Object.create;var V=Object.defineProperty;var ne=Object.getOwnPropertyDescriptor;var re=Object.getOwnPropertyNames;var ae=Object.getPrototypeOf,oe=Object.prototype.hasOwnProperty;var se=(e,s)=>{for(var a in s)V(e,a,{get:s[a],enumerable:!0})},j=(e,s,a,o)=>{if(s&&typeof s=="object"||typeof s=="function")for(let t of re(s))!oe.call(e,t)&&t!==a&&V(e,t,{get:()=>s[t],enumerable:!(o=ne(s,t))||o.enumerable});return e};var ie=(e,s,a)=>(a=e!=null?te(ae(e)):{},j(s||!e||!e.__esModule?V(a,"default",{value:e,enumerable:!0}):a,e)),ue=e=>j(V({},"__esModule",{value:!0}),e);var ge={};se(ge,{default:()=>pe});module.exports=ue(ge);var T=ie(require("react"));var $="mtag",D={TAG:"tag",LINE_BREAK:"line-break"};function S(e,s,a=!1){var l,f;if(!e)return[];let o=Array.from(e),t=[];for(let m=0;m<o.length;m+=1){let i=o[m],A=t.at(-1);if(i instanceof Node&&i.nodeName==="#text"&&i.textContent!==`
`&&i.textContent!==""){let C=ce(i.textContent||"");typeof A=="string"?t[t.length-1]=A+C:t.push(C||"")}if(i instanceof HTMLElement&&i.nodeName==="SPAN"){let C=(l=i==null?void 0:i.classList)==null?void 0:l.value.replace($,"").trim(),h=((f=i==null?void 0:i.dataset)==null?void 0:f.id)||"";t.push({...a?{tagId:h}:{},type:D.TAG,label:i.innerHTML||i.innerText,...C?{classes:C}:{},...s.current[h]?{data:s.current[h]}:{}})}i instanceof HTMLElement&&i.nodeName==="BR"&&t.push({type:D.LINE_BREAK})}return t}function ce(e){return e.replace(/[\u200B]/g,"")}function le({classes:e,text:s,id:a,showTagDeleteBtn:o}){return`<span data-id="${a}" class="${$} ${e}" contenteditable="false">${s.trim()}${o?'<button class="mtag-delete-btn" contenteditable="false" tabindex="-1">\xD7</button>':""}</span>&ZeroWidthSpace;`}function w({valueArr:e,showTagDeleteBtn:s=!1,tagsDataRef:a,componentId:o}){return!Array.isArray(e)||e.length===0?"":e.reduce((t,l)=>{if(typeof l=="string")return t+=l;if(N(l)){let{label:f,classes:m,data:i}=l,A=W(o);return i&&(a.current[A]=i),t+=le({classes:m||"",text:f,id:A,showTagDeleteBtn:s})}return typeof l=="object"&&l.type==="line-break"?t+="<br>":""},"")}function W(e){let s=Date.now().toString(36),a=Math.random().toString(36).substr(2);return e+s+a}function q({componentId:e,tagsDataRef:s,showTagDeleteBtn:a,data:o}){let t=document.createElement("span");t.setAttribute("contentEditable","false");let l=W(e);if(t.setAttribute("data-id",l),t.classList.add($),t.innerHTML=o.label,o.classes&&t.classList.add(o.classes),o.data&&(s.current[l]=o.data,t.setAttribute("data-id",l)),a){let f=document.createElement("button");f.classList.add("mtag-delete-btn"),f.setAttribute("contentEditable","false"),f.setAttribute("tabIndex","-1"),f.innerHTML="&times;",t.appendChild(f)}return t}function O(e,s){var l;if(!e)return{foundNode:void 0,nodeIndex:0};let a=null,o=0,t=Array.from(e.childNodes);for(let f=0;f<t.length;f++){let m=t[f];if(m!=null&&m.textContent){let i=m.textContent.length;if(o+i>=s){a=m;break}o+=i}}return a||(a=t.at(-1),o=((l=a==null?void 0:a.textContent)==null?void 0:l.length)||0),{foundNode:a,nodeIndex:o}}function N(e){return typeof e=="object"&&e.type===D.TAG}function de(e){return typeof e=="object"&&e.type===D.LINE_BREAK}function Z({item:e,componentId:s,tagsDataRef:a,showTagDeleteBtn:o}){if(typeof e=="string"){let t=document.createTextNode(e);return t.textContent=e,t}else{if(N(e))return q({componentId:s,tagsDataRef:a,data:e,showTagDeleteBtn:o});if(de(e))return document.createElement("br");if(Array.isArray(e))return e.map(t=>{if(typeof t=="string"){let l=document.createTextNode(t);return l.textContent=t,l}else if(N(t))return q({componentId:s,tagsDataRef:a,data:t,showTagDeleteBtn:o})}).reverse()}}var fe=(0,T.forwardRef)((e,s)=>{let a=(0,T.useId)(),o=(0,T.useRef)({}),{onChange:t,onClick:l,value:f,multiline:m,placeholder:i,showTagDeleteBtn:A=!0,readonly:C=!1,onPaste:h,onKeyDown:k,onSelect:B,onFocus:F,...z}=e,_=(0,T.useRef)(w({componentId:a,tagsDataRef:o,valueArr:f,showTagDeleteBtn:A})),u=(0,T.useRef)(null),p=(0,T.useRef)(0);(0,T.useEffect)(()=>{u.current&&(u.current.innerHTML=w({componentId:a,tagsDataRef:o,valueArr:f,showTagDeleteBtn:A}))},[f]);let K=n=>{var b,L,R,y;let d=window.getSelection();if(!d)return;let r=d.getRangeAt(0);if(r.commonAncestorContainer!==u.current&&r.commonAncestorContainer.parentElement!==u.current)return;r.deleteContents();let c=Z({item:n,componentId:a,tagsDataRef:o,showTagDeleteBtn:A}),x=0;if(Array.isArray(c)?c.forEach(g=>{var M;g&&(g.nodeName!=="BR"&&(x+=((M=g.textContent)==null?void 0:M.length)||0),g.nodeName==="SPAN"&&(x+=1),r.insertNode(g),r.setEndAfter(g))}):c&&(c.nodeName!=="BR"&&(x+=((b=c.textContent)==null?void 0:b.length)||0),c.nodeName==="SPAN"&&(x+=1),r.insertNode(c),r.setEndAfter(c)),!c){console.error("invalid content");return}_.current=((L=u.current)==null?void 0:L.innerHTML)??"",p.current+=x,(R=u.current)==null||R.focus(),t==null||t(S((y=u.current)==null?void 0:y.childNodes,o))};(0,T.useImperativeHandle)(s,()=>({inputRef:u.current,insertContent:K,getValue:()=>{var n;return S((n=u.current)==null?void 0:n.childNodes,o)},setCaret:n=>I(n),caretPosition:p.current}));let J=()=>{var n;u.current&&(_.current=u.current.innerHTML),t==null||t(S((n=u.current)==null?void 0:n.childNodes,o))},Q=n=>{var d,r,c,x,b,L,R;if(k==null||k(n),n.key==="Enter"&&!m)n.preventDefault();else if(n.key==="Enter"&&m){n.preventDefault(),K({type:"line-break"});return}else if(n.key==="Backspace"){let{node:y,charCode:g}=H(G()),M=null;if(((d=y==null?void 0:y.previousSibling)==null?void 0:d.nodeName)==="SPAN"){let E=y==null?void 0:y.previousSibling;M=(r=E.getAttribute)==null?void 0:r.call(E,"data-id")}if(M&&g===8203){n.preventDefault();let E=S((c=u.current)==null?void 0:c.childNodes,o,!0),{label:P}=E.find(v=>N(v)&&(v==null?void 0:v.tagId)===M),Y=E.filter(v=>!(N(v)&&v.tagId===M)),ee=w({valueArr:Y,componentId:a,showTagDeleteBtn:A,tagsDataRef:o});u!=null&&u.current&&(u.current.innerHTML=ee),I(p.current-P.length-1)}else p.current>0&&(p.current-=1);return}else if(n.key==="ArrowLeft"){let{node:y,charCode:g}=H(p.current),M=y==null?void 0:y.previousSibling,E=(x=M==null?void 0:M.getAttribute)==null?void 0:x.call(M,"data-id");if(E&&g===8203){n.preventDefault();let P=(b=u.current)==null?void 0:b.querySelector(`[data-id="${E}"]`);I(p.current-(((L=P==null?void 0:P.textContent)==null?void 0:L.length)||0)-1)}return}else if(n.key==="ArrowRight"){let y=p.current+1,{node:g}=H(y);(g==null?void 0:g.nodeName)==="SPAN"&&(n.preventDefault(),I(p.current+(((R=g==null?void 0:g.textContent)==null?void 0:R.length)||0)+1));return}else n.key!=="Delete"&&n.key!=="Tab"&&(p.current+=1)},X=n=>{var d,r,c;n.target instanceof HTMLButtonElement&&n.target.classList.contains("mtag-delete-btn")&&((r=(d=n.target)==null?void 0:d.parentElement)==null||r.remove(),t==null||t(S((c=u.current)==null?void 0:c.childNodes,o))),l==null||l(n)};function G(){let n=0;if(window.getSelection){let d=window.getSelection();if(u.current&&(d!=null&&d.rangeCount)&&d.rangeCount>0){let r=d.getRangeAt(0),c=r.cloneRange();c.selectNodeContents(u.current),c.setEnd(r.endContainer,r.endOffset),n=c.toString().length}}return n}(0,T.useEffect)(()=>{I(p.current)},[p.current,f]);function I(n){let d=n;if(!u.current)return;let{foundNode:r,nodeIndex:c}=O(u.current,d);if(r!=null&&r.textContent){let x=document.createRange(),b=window.getSelection();if(!b)return;r!=null&&r.textContent&&(r==null?void 0:r.textContent.length)>=d-c?x.setStart(r,d-c):x.setStart(r,r.textContent.length),x.collapse(!0),b.removeAllRanges(),b.addRange(x),p.current=n}}function H(n){let d=n,{foundNode:r,nodeIndex:c}=O(u.current,d);if(r!=null&&r.textContent){let x=d-c-1,b=r.textContent[x];return{charCode:b==null?void 0:b.charCodeAt(0),node:r,nodeIndex:c,index:x}}return{}}return T.default.createElement("div",{"data-placeholder":i,"aria-label":"input",role:"textbox",tabIndex:0,className:"mix-tag-input",contentEditable:!C,ref:u,onInput:J,onKeyDown:Q,onClick:X,onSelect:n=>{B==null||B(n),p.current=G();let{charCode:d}=H(p.current+1);d===8203&&(p.current+=1,I(p.current))},onPaste:n=>{n.preventDefault();let r=n.clipboardData.getData("text/plain");K(r),h==null||h(n)},onFocus:n=>{I(p.current),F==null||F(n)},dangerouslySetInnerHTML:{__html:_.current},...m?{"aria-multiline":!0}:{},...z})}),U=fe;var pe=U;
//# sourceMappingURL=index.js.map