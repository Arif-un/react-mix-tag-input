{"version":3,"sources":["../src/index.ts","../src/MixInput.tsx","../src/utils.ts"],"sourcesContent":["import MixInput from './MixInput'\r\nimport type { MixInputProps, MixInputRef, MixInputValue } from './MixInputType.d'\r\nexport default MixInput\r\n\r\n\r\nexport type {\r\n  MixInputProps,\r\n  MixInputRef,\r\n  MixInputValue,\r\n}\r\n","import './MixInput.css'\r\n\r\nimport React, {\r\n  type ForwardedRef,\r\n  forwardRef,\r\n  type KeyboardEvent,\r\n  type MouseEvent,\r\n  type SyntheticEvent,\r\n  useEffect,\r\n  useImperativeHandle,\r\n  useRef,\r\n} from 'react'\r\n\r\nimport type { MixInputProps, MixInputRef, MixInputValue } from './MixInputType'\r\nimport { DEFAULT_TAG_CLASS, nodesToArray, tagValueArrToString } from './utils'\r\n\r\nconst MixInput = forwardRef((props: MixInputProps, ref: ForwardedRef<MixInputRef>) => {\r\n  const { onChange, onClick, value, multiline, placeholder, showTagDeleteBtn = true, readonly = false, ...restProps } = props\r\n  const contentRef = useRef(tagValueArrToString(value, showTagDeleteBtn))\r\n  const editorRef = useRef<HTMLDivElement | null>(null)\r\n\r\n  useEffect(() => {\r\n    if (!editorRef.current) return\r\n    editorRef.current.innerHTML = tagValueArrToString(value, showTagDeleteBtn)\r\n  }, [value])\r\n\r\n  const insertContent = (newContent: MixInputValue) => {\r\n    const selection = window.getSelection()\r\n    if (!selection) {\r\n      return\r\n    }\r\n\r\n    const range = selection.getRangeAt(0)\r\n\r\n    if (range.commonAncestorContainer !== editorRef.current && range.commonAncestorContainer.parentElement !== editorRef.current) {\r\n      return\r\n    }\r\n\r\n    range.deleteContents()\r\n\r\n    let node: HTMLSpanElement | Text | null = null\r\n    if (typeof newContent === 'string') {\r\n      node = document.createTextNode(newContent)\r\n      node.textContent = newContent\r\n    } else if (typeof newContent === 'object' && newContent.type === 'tag') {\r\n      node = document.createElement('span')\r\n      node.classList.add(DEFAULT_TAG_CLASS)\r\n      if (newContent.classes) {\r\n        node.classList.add(newContent.classes)\r\n      }\r\n      node.setAttribute('contentEditable', 'false')\r\n      node.innerHTML = newContent.label\r\n\r\n      if (showTagDeleteBtn) {\r\n        const deleteBtn = document.createElement('button')\r\n        deleteBtn.classList.add('mtag-delete-btn')\r\n        deleteBtn.setAttribute('contentEditable', 'false')\r\n        deleteBtn.setAttribute('tabIndex', '-1')\r\n        deleteBtn.innerHTML = '&times;'\r\n        node.appendChild(deleteBtn)\r\n      }\r\n    }\r\n\r\n    if (!node) {\r\n      console.error('invalid content')\r\n      return\r\n    }\r\n\r\n    range.insertNode(node)\r\n    const newRange = document.createRange()\r\n    newRange.setStartAfter(node)\r\n    newRange.setEndAfter(node)\r\n    selection.removeAllRanges()\r\n    selection.addRange(newRange)\r\n    editorRef.current?.focus()\r\n\r\n    contentRef.current = editorRef.current?.innerHTML ?? ''\r\n    onChange?.(nodesToArray(editorRef.current?.childNodes))\r\n  }\r\n\r\n  useImperativeHandle(ref, () => ({\r\n    inputRef: editorRef.current,\r\n    insertContent,\r\n    getValue: () => nodesToArray(editorRef.current?.childNodes),\r\n  }))\r\n\r\n  const handleContentChange = () => {\r\n    if (editorRef.current) {\r\n      contentRef.current = editorRef.current.innerHTML\r\n    }\r\n    onChange?.(nodesToArray(editorRef.current?.childNodes))\r\n  }\r\n\r\n  const handleKeyDown = (e: KeyboardEvent<HTMLDivElement>) => {\r\n    if (e.key === 'Enter' && !multiline) {\r\n      e.preventDefault()\r\n    }\r\n  }\r\n\r\n  const handleClicks = (e: SyntheticEvent) => {\r\n    if (e.target instanceof HTMLButtonElement && e.target.classList.contains('mtag-delete-btn')) {\r\n      e.target?.parentElement?.remove()\r\n      onChange?.(nodesToArray(editorRef.current?.childNodes))\r\n    }\r\n    onClick?.(e as MouseEvent<HTMLDivElement>)\r\n  }\r\n\r\n  return (\r\n    <div\r\n      data-placeholder={placeholder}\r\n      aria-label=\"input\"\r\n      role=\"textbox\"\r\n      tabIndex={0}\r\n      className=\"mix-tag-input\"\r\n      contentEditable={readonly ? false : true}\r\n      ref={editorRef}\r\n      onInput={handleContentChange}\r\n      onKeyDown={handleKeyDown}\r\n      onClick={handleClicks}\r\n      dangerouslySetInnerHTML={{ __html: contentRef.current }}\r\n      {...(multiline ? { 'aria-multiline': true } : {})}\r\n      {...restProps}\r\n    />\r\n  )\r\n})\r\n\r\nexport default MixInput\r\n","import { type MixInputValue } from './MixInputType'\r\n\r\nexport const DEFAULT_TAG_CLASS = 'mtag'\r\n\r\nexport function nodesToArray(nodes: NodeList | undefined): MixInputValue[] {\r\n  if (!nodes) return []\r\n\r\n  const nodeArr = Array.from(nodes)\r\n  const arr: MixInputValue[] = []\r\n\r\n  for (let i = 0; i < nodeArr.length; i += 1) {\r\n    const arrItem: Node | HTMLElement = nodeArr[i]\r\n    const lastItem: MixInputValue | undefined = arr.at(-1)\r\n    if (\r\n      arrItem instanceof Node &&\r\n      arrItem.nodeName === '#text' &&\r\n      arrItem.textContent !== '\\n' &&\r\n      arrItem.textContent !== ''\r\n    ) {\r\n      if (typeof lastItem === 'string') {\r\n        arr[arr.length - 1] = lastItem + arrItem.textContent\r\n      } else {\r\n        arr.push(arrItem.textContent || '')\r\n      }\r\n    }\r\n    if (arrItem instanceof HTMLElement && arrItem.nodeName === 'SPAN') {\r\n      const classes = arrItem?.classList?.value.replace(DEFAULT_TAG_CLASS, '').trim()\r\n      arr.push({\r\n        type: 'tag',\r\n        label: arrItem.innerHTML || arrItem.innerText,\r\n        ...(classes ? { classes } : {}),\r\n      })\r\n    }\r\n  }\r\n\r\n  return arr\r\n}\r\n\r\nexport function tagValueArrToString(valueArr: MixInputValue[] | undefined, isTagDeletable = false): string {\r\n  if (!Array.isArray(valueArr) || valueArr.length === 0) {\r\n    return ''\r\n  }\r\n\r\n  return valueArr.reduce((acc: string, item: MixInputValue) => {\r\n    if (typeof item === 'string') {\r\n      return (acc += item)\r\n    }\r\n    if (typeof item === 'object') {\r\n      const { label, classes } = item\r\n      return (acc += `<span class=\"${DEFAULT_TAG_CLASS} ${classes || ''\r\n        }\" contenteditable=\"false\">${label} ${isTagDeletable ? '<button class=\"mtag-delete-btn\" contenteditable=\"false\" tabindex=\"-1\">Ã—</button>' : ''}</span>`)\r\n    }\r\n    return ''\r\n  }, '')\r\n}\r\n\r\nexport function getCaretOffset(element: HTMLElement | null): number {\r\n  let caretOffset = 0\r\n  const sel = window.getSelection()\r\n\r\n  if (sel?.rangeCount && element) {\r\n    const range = sel.getRangeAt(0)\r\n    const preCaretRange = range.cloneRange()\r\n    preCaretRange.selectNodeContents(element)\r\n    preCaretRange.setEnd(range.endContainer, range.endOffset)\r\n    caretOffset = preCaretRange.toString().length\r\n  }\r\n  return caretOffset\r\n}\r\n"],"mappings":"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","names":["src_exports","__export","src_default","__toCommonJS","import_react","DEFAULT_TAG_CLASS","nodesToArray","nodes","_a","nodeArr","arr","i","arrItem","lastItem","classes","tagValueArrToString","valueArr","isTagDeletable","acc","item","label","MixInput","props","ref","onChange","onClick","value","multiline","placeholder","showTagDeleteBtn","readonly","restProps","contentRef","tagValueArrToString","editorRef","insertContent","newContent","_a","_b","_c","selection","range","node","DEFAULT_TAG_CLASS","deleteBtn","newRange","nodesToArray","React","e","MixInput_default","src_default","MixInput_default"]}